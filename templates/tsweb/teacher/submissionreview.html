{% load staticfiles %}
<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8"/> 
	
	<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/smoothness/jquery-ui-1.10.3.custom.min.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/jquery.tagedit.css' %}" />
	<link rel="stylesheet" href="{% static 'tsweb/css/bootstrap.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'tsweb/css/bootstrap-glyphicons.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'tsweb/css/topscholars.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'tsweb/css/redactor.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'tsweb/css/jquery.comment.css' %}" type="text/css" />
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	
	<script src="{% static 'tsweb/js/jQuery1-10-1.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/WaterMark.js' %}"></script>
	<script src="{% static 'tsweb/js/bootstrap.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/transition.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>
	<script src="{% static 'tsweb/js/jquery.cookie.js' %}"></script>
	<script src="{% static 'tsweb/js/util.js' %}"></script>

	<script src="{% static 'tsweb/js/redactor.min.js' %}"></script>
	<script src="{% static 'tsweb/js/jquery.comment.js' %}"></script>
	<script src="{% static 'tsweb/js/jquery.autoGrowInput.js' %}"></script>
	<script src="{% static 'tsweb/js/jquery.tagedit.js' %}"></script>

	<script>
		$(document).ready(function () {
			/*
			$("#commentSection").comments({
			     getCommentsUrl: "/JqComment/GetComments",
			     postCommentUrl: "/JqComment/PostComment",
			     deleteCommentUrl: "/JqComment/DeleteComment",
			});
			*/			
			
			$("[rel=popover]").popover();
			
		});	
	</script>
</head>

<body>
<script>
    var submissionreviewerid;
    var highlightid;

    function EDITTABLE() {
        var thisClass = this;
        var evalClass = 'SUBMISSIONREVIEW';
        var url = "{% url 'tsweb:tprocessajax' %}";

        this.getSelectRubricCriteria = function (id, rubricid) {
            //var html = '';
            //$.getJSON(
            //    url,
            //    {
            //        'class': evalClass,
            //        'method': 'getSelectRubricCriteria',
            //        'rubricid': rubricid
            //    },
            //    function (result) {
            //        $.each(result, function (ini, val) {
            //            html += '<option value="' + val.id + '">' + val.scale + '</option>';
            //        });
            //        $('#' + id + '.submit_criteria').append(html);
            //    }).error(function (xhr, status, error) {
            //        alert('Error occur. Please contact the administrator.');
            //    });
        }

        this.getSubmitRubric = function () {
            //var html = '';
            //$.getJSON(
            //    url,
            //    {
            //        'class': evalClass,
            //        'method': 'getSubmitRubric',
            //        'submissionid': $("#ele_submissionid").val()
            //    },
            //    function (result) {
                    //$(".submitRubricTr").remove();
                    //$.each(result,function(ini, val){
                    //	html += '<tr class="submitRubricTr"><td>'+val.criteria+' :</td><td>';
                    //	html += '<select class="submit_criteria" id="'+val.id+'" name="'+val.criteria+'">';
                    //	html += '</select>';
                    //	html += '</td></tr>';
                    //	thisClass.getSelectRubricCriteria(val.id, val.rubricid); 
                    //});
                    //$(html).insertBefore("#editSubmit");
                //}).error(function (xhr, status, error) {
                //    alert('Error occur. Please contact the administrator.');
                //});
        }

        this.tagClickHighlightList = function(id){
        	var textComment = '';
        	$.getJSON(
        		url,
        		{	'class' :  evalClass,
        			'method' : 'tagClickHighlightList',
        			'taglinkid' : id,
        			'submissionreviewerid': submissionreviewerid
        		},
        		function(result){
        		$(".essayhighlight").css({'background':'red'});
        		$.each(result, function(i, val) {
        			var spanid = val[0];
        			$('inline[name="' + spanid + '"].essayhighlight').css({ 'background': val[2] });
        			textComment += "- " + val[1] + "<br/>";
        		});
        		$("#commentSection").html(textComment);
        	}).error(function(xhr, status, error) {
        		alert('Error occur. Please contact the administrator.');
        	});
        }

        this.tagHighlightList = function () {
            $.getJSON(
                url,
                {
                    'class': evalClass,
                    'method': 'tagHighlightList',
                    'submissionreviewerid': submissionreviewerid
                },
                function (result) {
                    $("#tagList li").remove();
                    $("#tagBox").html('');
                    $("#commentArea").val('');
                    $("<ul>").attr("id", "tagList").appendTo("#tagBox");
                    if (result.length > 0) {

                        $.each(result, function (i, val) {
                            var li = $("<li>");

                            //create link
                            $("<a>").text(val[1]+"("+val[3]+")").attr({ "data-id": val[0], href: "#", class: "tagClickHighlightList" }).appendTo(li);

                            //set tag size
                            if (val[2] == 0) {
                                li.children().css({ 'font-size': '1.5em', 'font-weight': 'bold' });
                            } else {
                                li.children().css({ 'font-size': '1.2em' });
                            }

                            //add to list
                            li.appendTo("#tagList");
                        });
                    } else {
                        $("#tagList").height('50');
                    }

                    $(".tagClickHighlightList").click(function () {
                        var id = $(this).data("id");
                        thisClass.tagClickHighlightList(id);
                        return false;
                    });
                }).error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
        }

        this.getData = function () {
            $.getJSON(
                url,
                {
                    'class': 'SUBMISSIONREVIEW',
                    'method': 'getSubmissionReviewer',
                    'submissionreviewerid': submissionreviewerid
                },
                function (result) {
                    $('#ele_submissionversionessay').redactor('set', result.essay);

                    if (result.status == 0) {
                        $('#btnedithighlight').show();
                        $('#saveAssignment').show();
                    }
                    else {
                        $('#btnedithighlight').hide();
                        $('#saveAssignment').hide();
                        $('#ele_submissionversionessay').unbind('mouseup');
                    }

                    thisClass.tagHighlightList();
                    thisClass.getSubmitRubric();
                })
                .error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
        }

        this.getSelectionCharOffsetsWithin = function (element) {
            var start = 0, end = 0;
            var sel, range, priorRange;
            if (typeof window.getSelection != "undefined") {
                range = window.getSelection().getRangeAt(0);
                priorRange = range.cloneRange();
                priorRange.selectNodeContents(element);
                priorRange.setEnd(range.startContainer, range.startOffset);
                start = priorRange.toString().length;
                end = start + range.toString().length;
            } else if (typeof document.selection != "undefined" &&
                    (sel = document.selection).type != "Control") {
                range = sel.createRange();
                priorRange = document.body.createTextRange();
                priorRange.moveToElementText(element);
                priorRange.setEndPoint("EndToStart", range);
                start = priorRange.text.length;
                end = start + range.text.length;
            }
            return {
                start: start,
                end: end
            };
        }

        this.essayEvent = function () {
            $('#ele_submissionversionessay').mouseup(function () {
                if (thisClass.getSelectionCharOffsetsWithin(this).start != thisClass.getSelectionCharOffsetsWithin(this).end) {
                    var redactor_object = $('#ele_submissionversionessay').redactor('getObject');
                    redactor_object.selectionSave();
                    thisClass.showHighlightDialog(true);
                }
            }).keypress(function (e) {
                return false;
            });
        }

        this.editHighlightDialog = function (edit) {
            if (edit) {
                $('#edithighlight').show();
                $('#viewhighlight').hide();
                $('#tdtagdisplay').hide();
                $('#tdtag').show();
                $('#ele_highlightTag').removeAttr("disabled");
                $('#ele_highlightComment').removeAttr("disabled");
                $('.tagedit-list').removeAttr("disabled");
                $('#ele_highlightCategory').removeAttr("disabled");
            }
            else {
                $('#edithighlight').hide();
                $('#viewhighlight').show();
                $('#tdtagdisplay').show();
                $('#tdtag').hide();
                $('#ele_highlightTag').attr("disabled", "disabled");
                $('#ele_highlightComment').attr("disabled", "disabled");
                $('#ele_highlightCategory').attr("disabled", "disabled");
            }
        }

        this.showHighlightDialog = function (show) {
            if (show) {
                $('#diveditbg').show();
                $('#divedithighlight').show();
                $('.editHighlightSuggest').hide();
                if (highlightid != '') {
                    thisClass.editHighlightDialog(false);
                    $('#btndeletehighlight').show();
                }
                else {
                    thisClass.editHighlightDialog(true);
                    $('#btndeletehighlight').hide();
                }
            }
            else {
                $('#diveditbg').hide();
                $('#divedithighlight').hide();
                highlightid = '';
                $('#ele_highlightTagDisplay').text('');
                $('.tagedit-listelement-old').remove();
                $('#ele_highlightComment').val('');
                $('#ele_highlightCategory').val('');
            }
        }

        this.getHighlightDataTag = function () {
            var tagids = [];
            $.getJSON(
                url,
                {
                    'class': 'SUBMISSIONREVIEW',
                    'method': 'getSubmissionVersionHighlightTags',
                    'highlightid': highlightid
                },
                function (result) {
                    $(".tagedit-listelement-old").remove();
                    var displaytxt = '';
                    for (var i = 0; i < result.length; i++) {
                        tagids.push(result[i].id);
                        thisClass.addTagEditElement(result[i].name, result[i].id);
                        if (displaytxt != '')
                            displaytxt = displaytxt + ', '
                        displaytxt = displaytxt + result[i].name;
                    }
                    thisClass.tagEditCloseEvent();
                    thisClass.getSelectSuggest(tagids);
                    $('#ele_highlightTagDisplay').text(displaytxt);
                })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
        }

        this.getHighlightData = function () {
            $.getJSON(
                url,
                {
                    'class': 'SUBMISSIONREVIEW',
                    'method': 'getSubmissionVersionHighlight',
                    'highlightid': highlightid
                },
                function (result) {
                    $.each(result, function (ini, val) {
                        if ($('#ele_' + ini).is("span") || $('#ele_' + ini).is("div"))
                            $('#ele_' + ini).html(val);
                        else
                            $('#ele_' + ini).val(val);
                    });

                    thisClass.getHighlightDataTag();
                    thisClass.showHighlightDialog(true);
                })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
        }

        this.saveEditTags = function (tagids, method) {
            var odata;
            if (method == 'add') {
                odata = {
                    class: evalClass,
                    method: 'addSubmissionversionHighlight',
                    submissionreviewerid: submissionreviewerid,
                    highlightComment: $('#ele_highlightComment').val(),
                    tagids: tagids,
                    categoryid: $('#ele_highlightCategory').val()
                };
            } else if (method == 'save') {
                odata = {
                    class: evalClass,
                    method: 'saveSubmissionversionHighlight',
                    highlightid: highlightid,
                    highlightComment: $('#ele_highlightComment').val(),
                    tagids: tagids,
                    categoryid: $('#ele_highlightCategory').val()
                };
            }

            $.post(url, odata,
                function (result) {
                    highlightid = result.recid;
                    var redactor_object = $('#ele_submissionversionessay').redactor('getObject');
                    redactor_object.selectionRestore();
                    redactor_object.inlineSetAttr('name', result.recid);
                    redactor_object.inlineSetStyle("background-color", "red");
                    redactor_object.inlineSetClass('essayhighlight');
                    redactor_object.inlineSetAttr('onClick', 'openHighlightDialog(' + result.recid + ')');
                    redactor_object.sync();

                    odata = {
                        class: evalClass,
                        method: 'updateReviewerEssay',
                        submissionreviewerid: submissionreviewerid,
                        essay: $('#ele_submissionversionessay').redactor('getEditor').html()
                    };

                    $.post(url, odata,
                        function (result) {
                            thisClass.tagHighlightList();
                            thisClass.getSubmitRubric();
                            thisClass.getHighlightData();
                            thisClass.editHighlightDialog(false);
                    })
                    .error(function (xhr, status, error) {
                        alert('Error occur. Please contact the administrator.');
                    });
                })
                .error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
        }

        this.save = function () {
            var tagids = [];
            var i = 0;
            $('input[name*="-a"]').each(function (index) {
                var name = $(this).attr('name');
                name = name.replace('tag[', '');
                name = name.replace('-a]', '');
                tagids.push(name);
            });
            if (highlightid != '') {
                //update
                thisClass.saveEditTags(tagids, 'save');
            }
            else {
                //insert
                thisClass.saveEditTags(tagids, 'add');
            }
        }

        this.del = function () {
            var redactor_object = $('#ele_submissionversionessay').redactor('getObject');
            $('inline[name="' + highlightid + '"]').each(function () {
                redactor_object.selectionElement(this);
                redactor_object.inlineRemoveAttr('name');
                redactor_object.inlineRemoveAttr('onClick');
                redactor_object.inlineRemoveClass('essayhighlight');
                redactor_object.inlineRemoveStyle('background-color');
                redactor_object.inlineRemoveAttr('onClick');
                redactor_object.sync();
            });

        	$.post(url,
        		{	'class' :  'SUBMISSIONREVIEW',
        			'method' : 'delete',
        			'submissionreviewerid': submissionreviewerid,
        			'highlightid': highlightid,
        			'essay': $('#ele_submissionversionessay').redactor('getEditor').html()
        		},
        		function(result){
        			thisClass.showHighlightDialog(false);
        			thisClass.tagHighlightList();
        			thisClass.getSubmitRubric();
        		})
        	.error(function(xhr, status, error) {
        		alert('Error occur. Please contact the administrator.');
            });
        }

        this.tagEditCloseEvent = function () {
            $(".tagedit-close").unbind('click');
            $(".tagedit-close").click(function () {
                var tagElement = $(this).prev();
                var thisInput = tagElement.attr('name');
                thisInput = thisInput.replace('tag[', '');
                thisInput = thisInput.replace('-a]', '');
                var thisId = thisInput;
                var tagNewIds = [];
                $('input[name*="-a"]').each(function (index) {
                    var nameInput = $(this).attr('name');
                    nameInput = nameInput.replace('tag[', '');
                    nameInput = nameInput.replace('-a]', '');
                    if (nameInput != thisId) {
                        tagNewIds.push(nameInput);
                    }
                });
                thisClass.getSelectSuggest(tagNewIds);
            });
        }

        this.addTagEditElement = function (name, id) {
            var tagitem = '<li class="tagedit-listelement tagedit-listelement-old"><span dir="ltr">' + name + '</span><input type="hidden" name="tag[' + id + '-a]" value="' + name + '"><a class="tagedit-close" title="Remove from list.">x</a></li>'
            $(tagitem).insertBefore('.tagedit-listelement-new');
        }

        this.getSelectSuggest = function (tagids) {
            var option = '';
            if (tagids != "") {
                $.post(
                    url,
                    {
                        'class': evalClass,
                        'method': 'getSelectSuggest',
                        tagids: tagids
                    },
                    function (result) {
                        $("#ele_suggestTags option").remove();
                        $.each(result, function (ini, val) {
                            option += '<option value="' + val.id + '">' + val.label + '</option>';
                        });
                        $("#ele_suggestTags").append(option);

                        $("#ele_suggestTags").unbind('dblclick');
                        $("#ele_suggestTags").dblclick(function () {
                            var id = $(this).val();
                            var name = $("#ele_suggestTags option:selected").text();
                            $("#ele_suggestTags option[value='" + id + "']").remove();
                            thisClass.addTagEditElement(name, id);

                            var tagNewIds = [];

                            $('input[name*="-a"]').each(function (index) {
                                var nameInput = $(this).attr('name');
                                nameInput = nameInput.replace('tag[', '');
                                nameInput = nameInput.replace('-a]', '');
                                tagNewIds.push(nameInput);
                            });
                            thisClass.tagEditCloseEvent();
                            thisClass.getSelectSuggest(tagNewIds);
                        });
                    }).error(function (xhr, status, error) {
                        alert('Error occur. Please contact the administrator.');
                    });
            } else {
                $("#ele_suggestTags option").remove();
                $(".editHighlightSuggest").hide();
            }
        }

        this.showSubmitDialog = function (show) {
            if (show) {
                $('#diveditbg').show();
                $('#submitpopup').show();
            }
            else {
                $('#diveditbg').hide();
                $('#submitpopup').hide();
            }
        }

        this.submit = function() {
        	//var criteriaid =[]; 
        	//var criteriaval = [];
        	//var value,odata;
        	//var submissionversionid = $('#ele_submissionversionid').val();
        	//thisClass.showSubmitDialog(true);

        	//$(".submit_criteria").each(function(){
        	//	id = $(this).attr('id');
        	//	value = $(this).val();

        	//	criteriaid.push(id);
        	//	criteriaval.push(value);
        	//});
        	//odata = {'class' :  'SUBMISSIONREVIEW',
        	//	 'method' : 'submit',
        	//	 'submissionversionid' : submissionversionid,
        	//	 'stage' : $("#submit_stage").val(),
        	//	 'comment' : $("#submit_comment").val(),
        	//	 'progress' : $("#submit_progress").val(),
        	//	 'criteriaid': criteriaid,
        	//	 'criteriaval': criteriaval
        	//	 };

        	//$.post(url,odata,
        	//	function(result){
        	//		thisClass.showSubmitDialog();
        	//		window.location = "{% url 'tsweb:tsubmissionlist' %}";
        	//	})
        	//.error(function(xhr, status, error) {
        	//	alert('Error occur. Please contact the administrator.');
        	//});
        }

        this.initContent = function () {
            submissionreviewerid = '{{ id }}';
            //$('#ele_submissionversionessay').redactor({ toolbar: false });
            $('#ele_submissionversionessay').redactor();
            $('#tdtag input.tag').tagedit({
                autocompleteURL: "{% url 'tsweb:gettags' 5 %}",
                autocompleteOptions: { minLength: 1 },
                allowEdit: false
            });
            $('#btnedithighlight').click(function () {
                thisClass.editHighlightDialog(true);
                $('.editHighlightSuggest').show();
            });

            $('#btncloseedithighlight').click(function () {
                thisClass.showHighlightDialog(false);
            });
            $('#btnsavehighlight').click(function () {
                thisClass.save();
                thisClass.editHighlightDialog(false);
            });
            $('#btncancelhighlight').click(function () {
                if (highlightid != '') {
                    thisClass.getHighlightData();
                    thisClass.editHighlightDialog(false);
                }
                else {
                    thisClass.showHighlightDialog(false);
                }
            });
            $('#btndeletehighlight').click(function () {
                thisClass.del();
            });
            $('#saveAssignment').click(function () {
                thisClass.showSubmitDialog(true);
            });

            $("#btncancelsubmit").click(function () {
                thisClass.showSubmitDialog();
            });

            $("#btnsavesubmit").click(function () {
                thisClass.submit();
            });
            $('#ele_submissionversionversion').change(function () {
                submissionreviewerid = $('#ele_submissionversionversion').val();
                thisClass.getData();
            });
            $(document).on('click', '.ui-menu-item', function () {
                $('.editHighlightSuggest').show();
                var tagNewIds = [];

                $('input[name*="-a"]').each(function (index) {
                    var nameInput = $(this).attr('name');
                    nameInput = nameInput.replace('tag[', '');
                    nameInput = nameInput.replace('-a]', '');
                    tagNewIds.push(nameInput);
                });
                thisClass.tagEditCloseEvent();
                thisClass.getSelectSuggest(tagNewIds);
            });

            thisClass.essayEvent();
            thisClass.showHighlightDialog(false);

            thisClass.getData();
        }
    }

    $(function () {
        var gen = new EDITTABLE();
        gen.initContent();
    });

    function openHighlightDialog(id) {
        var gen = new EDITTABLE();
        highlightid = id;
        gen.getHighlightData();
    }
</script>
	<nav class="navbar" role="navigation">
		<div class="container">
			<h1 class="logo"><a href="#">Writability - My Classroom</a></h1>
			<ul class="nav navbar-nav pull-right student-nav" >
				
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-bullhorn fa-lg notification"></i></a>
					<ul class="dropdown-menu">
						<li class="dropdown-title">Notifications</li>
						<li><a href="#">{# notification-name #}</a></li>
					</ul>
				</li>
				
				<li class="dropdown">
					<a href="#" class="dropdown-toggle student-name" data-toggle="dropdown">{{ user_name }}</a>
					<ul class="dropdown-menu">
						<li><a href="{% url 'tsweb:logout' %}"><i class="fa fa-power-off"></i> Log Out</a></li>
					</ul>
				</li>
			</ul>
			
			<form class="navbar-form navbar-left" role="search" id="search-form" method="" action="null">
				<div class="input-group col-lg-3 col-offset-6">
					<input type="text" class="form-control" id="txtSearch">
			    <span class="input-group-btn">
			      <input class="btn btn-default" type="submit" value="Search">
			    </span>
			  </div><!-- /input-group -->
			</form>
	    
		</div>
	</nav> <!-- End Nav -->
	
	<!-- submit block -->
	<div id="diveditbg" style="background-color:gray;z-index:1;width:100%;height:100%;position:absolute;opacity:0.4;"></div>
	<div id="submitpopup" style="z-index:2;width:500px;position:absolute;background-color:white;margin-top:10%;margin-left:35%;padding:10px;display:none;">
	<table style="width:100%;">
		<tr>
			<td>Stage :</td>
			<td><select id="submit_stage">
                {% for row in selectionlist %}
					<option value="{{ row.selectionvalue }}">Revision {{ row.selectionname }}</option>
				{% endfor %}
			    </select></td>	
		</tr>
		<tr>
			<td>Comment :</td>
			<td>
				<textarea id="submit_comment"></textarea>
			</td>
		</tr>
		<tr>
			<td>Progress :</td>
			<td><input type="text" id="submit_progress"></td>
		</tr>
		<tr id="editSubmit">
			<td colspan="2" style="text-align:center;">
				<input id="btnsavesubmit" type="button" class="button" style="width:80px;height:26px;" value="Save">&nbsp;
				<input id="btncancelsubmit" type="button" class="button" style="width:80px;height:26px;" value="Cancel">
			</td>
		</tr>
	</table>
	</div>
	<!-- end submit block -->
	<div class="page-container">
		


		<div class="assignment-edit-section">
		
			<div class="block-cell block-wide">
				
				
				<div class="controls">
					<a href="{% url 'tsweb:tsubmissionlist' %}" class="btn btn-warning btn-small pull-right" id="exitBtn" style="margin-left: 10px;">Exit</a>
					<input type="submit" id="saveAssignment" class="btn btn-info btn-small pull-right" value="Save Assignment" style="margin-left: 10px;" />
					<div class="searchlist pull-right">
						<div class="form-group">
							<!--<label for="lstClassid" class="col-sm-4 control-label">Revision Filter:&nbsp;</label>-->
							<select id="ele_submissionversionversion" class="form-control input-small">
								<option value="">Please Select</option>
							{% for row in submissionreviewerlist %}
								<option value="{{ row.id }}">Revision {{ row.submissionversionid.version }}</option>
							{% endfor %}
							</select>
						</div>
					</div>
				</div>
				<br /><br />
				<div id="ele_submissionversionessay" name="submissionversionessay" style="width: 100%; height: auto;"></div>

				<!--<div id="redactor_editor" name="content" style="width: 100%; height: auto;"></div>-->
						<!--ADD TAGGING BUTTON OR HIGHLIGHT STATE-->
			</div>
		</div>
		
		<div class="tag-list-dropdown col-lg-2" style="display: none;">
			<form class="form" role="form">
		    <div class="input-group input-group-sm">
		      <input type="text" class="form-control">
		      <span class="input-group-btn">
		        <input class="btn btn-info" type="submit" value="Add Tag"/>
		      </span>
		    </div><!-- /input-group -->
				
			<ul id="taglist">
				<li><a href="#">{# tag #}</a></li>
			</ul>
				
				<!--<input type="submit" name="add-tab" value="Add Tag" class="btn btn-primary btn-small pull-right" />-->
			</form>
		</div>
				
		<div class="panel-group side-panel panel-revision" id="side-panel">
		
			<div class="panel panel-default block-cell block-thin block-expanded">
				<div class="panel-heading block-header">
					<h3 class="panel-title">
						<a data-toggle="collapse" data-parent="#side-panel" href="#collapseFour">
							Rubric
						</a>
					</h3>
				</div>
				<div id="collapseFour" class="panel-collapse collapse">
					<div class="block-body">
						<!--<div>{# rubric #}</div>-->
						
						<div class="rubric-categories-sm">
							<div class="rubric-impact circle circle-blue"
										data-toggle="modal"
										data-target="#impact_modal">
								<p>Impact</p>
								<div class="weight-percent circle-val" id="impact_percent">{# val #} %</div>
							</div>
							
							<div class="rubric-quality circle circle-green"
										data-toggle="modal"
										data-target="#quality_modal">
								<p>Quality</p>
								<div class="weight-percent circle-val" id="quality_percent">{# val #} %</div>
							</div>
							
							<div class="rubric-objective circle circle-grey"
										data-toggle="modal"
										data-target="#objective_modal">
								<div>Objective</div>
							</div>
							
							<div class="rubric-content circle circle-purple"
										data-toggle="modal"
										data-target="#content_modal">
								<p>Content</p>
								<div class="weight-percent circle-val" id="content_percent">{# val #} %</div>
							</div>
							
							<div class="rubric-process circle circle-red"
										data-toggle="modal"
										data-target="#process_modal">
								<p>Process</p>
								<div class="weight-percent circle-val" id="process_percent">{# val #} %</div>
							</div>
						</div>
						
						<ul class="block-list hide" id="criteriaList">
							<li><label>Criteria</label></li>
							<li class="criteriaItem tag">
								<a href="#" data-toggle="modal" data-target="#criteria_modal">a{# criteria-name-which-could-be-really-long-or-not #}</a>
							</li>
							
							<li class="criteriaItem tag">
								<a href="#">{# criteria-name #}</a>
							</li>
							
							<li class="criteriaItem tag">
								<a href="#">{# criteria-name #}</a>
							</li>
							
							<li class="criteriaItem tag">
								<a href="#">{# criteria-name #}</a>
							</li>
							
							<li class="criteriaItem tag">
								<a href="#">{# criteria-name #}</a>
							</li>
							
							<li class="criteriaItem tag">
								<a href="#">{# criteria-name #}</a>
							</li>
							
							<li class="criteriaItem tag">
								<a href="#">{# criteria-name #}</a>
							</li>
							
						</ul>
					</div>
				</div>
			</div>
			
			
			<!--
			<div class="panel panel-default block-cell block-thin block-expanded">
				<div class="panel-heading block-header">
					<h3 class="panel-title">
						<a data-toggle="collapse" data-parent="#side-panel" href="#collapseFive">
							Criteria
						</a>
					</h3>
				</div>
				
				<div id="collapseFive" class="panel-collapse collapse">
					<div class="block-body">
						<ul class="block-list" id="criteriaList">
							<li class="criteriaItem tag">
								<a href="#">{# criteria-name #}</a>
							</li>
						</ul>
					</div>
				</div>
				
			</div>
			-->
					  
			  <div class="panel panel-default block-cell block-thin">
			  	
			    <div class="panel-heading block-header">
			      <h3 class="panel-title">
			        <a data-toggle="collapse" data-parent="#side-panel" href="#collapseTwo">
			          Tagging
			        </a>
			      </h3>
			    </div>
			    <div id="collapseTwo" class="panel-collapse collapse">
			      <div class="block-body">
			        <ul class="block-list" id="tagList">
			        	<li class="tag">
				        	<a href="#" id="tag-details" rel="popover"
				        		data-placement="left"
				        		data-container="body"
				        		data-toggle="popover" title
				        		data-trigger="hover"
				        		data-content="{# tag-details #} this is some more info about this tag.  Of course it will be loaded dynamically.."
				        		role="button">{# tag-name #}
				        		<span class="fa fa-frown-o"></span>
			        		</a>
		        		</li>
			        </ul>
			      </div>
			    </div>
			  </div>
		
			  <div class="panel panel-default block-cell block-thin">
			    <div class="panel-heading block-header">
			      <h3 class="panel-title">
			        <a data-toggle="collapse" data-parent="#side-panel" href="#collapseThree">
			          Comments
			        </a>
			      </h3>
			    </div>
			    <div id="collapseThree" class="panel-collapse collapse">
			      <div class="block-body">
			       	<div id="commentSection">
			       	
			       	</div>
			      </div>
			    </div>
			  </div>
				  
			</div> <!--End Side Panel-->
			
		
			
	</div> <!-- end page container -->
	
		<!--<div class="lesson" id="lessonSmall" style="display: none;">
	
		<div class="lesson-body">
			<div class="lesson-section">
				<div class="lesson-section-header lesson-header-small">{# lesson_name #}
					<button type="button" class="close" aria-hidden="true">&times;</button>
				</div>
				<div class="lesson-section-body">
					<form class="form form-inline" role="form">
						<div class="section-one">
							<select class="form-control">
								<option>Choose Unit</option>
							</select>
							<select class="form-control">
								<option>Lesson</option>
							</select>
							<select class="form-control">
								<option>Activity</option>
							</select>
						</div><!-- /.section-one -->
						
						<!-- <div class="section-two ">
							<legend>Explanation:</legend>
							<p>{# question #}</p>
							
							<legend>Explanation:</legend>
							<p>{# answer #}</p>
						</div>
						
						<div class="section-three text-center">
							<div class="row form-group">
								<a href="unitlist.html" class="btn btn-danger" role="button" id="pfbBtn"><i class="fa fa-angle-left"></i> Return to Unit</a>
							</div>
							<div class="row form-group">
								<button class="btn btn-success" role="button" id="answerBtn">Answer</button>
								<button class="btn btn-info" role="button">Chronology: {# #}</button>
							</div>
							<div class="row form-group">
								<button class="btn btn-warning" role="button">Type: Dynamic</button>
							</div>
							<div class="row form-group">
								<button class="btn btn-default" role="button"><i class="fa fa-angle-left"></i> Back</button>
								<button class="btn btn-default" role="button">Next <i class="fa fa-angle-right"></i></button>
								<button class="btn btn-primary" type="submit" role="button">Submit</button>
							</div>
							<!--<button class="btn btn-info" role="button">Record Answer</button>-->
						<!-- </div>
						
					</form>
				</div>
			</div>
		</div>
		
	</div> <!-- /. lesson small -->-->
	
	<!--Modal for Impact-->
		<div class="modal fade modal-wide" id="impact_modal" tabindex="-1" role="dialog" aria-labelledby="impactRubric" aria-hidden="true" data-dismiss="false">
		  <div class="modal-dialog">
		    <div class="modal-content">
		      <div class="modal-header teacher-header">
		        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		        <h4 class="modal-title">Impact</h4>
		      </div>
		      <div class="modal-body">
		        <form role="form" class="form-inline" id="impact_form">
	
		        	<div class="criteria-list">
		        		<ul col-lg-12>
		        			<li class="well well-small">Answer the prompt beyond a reasonable doubt
		        				<p>
		        				  <label for="grade1">Grade:</label>
		        				  <input type="text" id="grade1" style="border:0; color:#f6931f; font-weight:normal;">
		        				</p>
		        				<div id="grade-slider1" class="grade-slider"></div>
		        			</li>
		        		</ul>
		        	</div>
		        	
		        	<div class="modal-footer">
		        	  <input type="reset" class="btn btn-default" data-dismiss="modal" value="Close"/>
		        	  <input type="submit" class="btn btn-primary" value="Save" id="btnSave"/>
		        	</div>
		        	
		        </form>
		      </div><!-- /.modal-body -->
		      
		    </div><!-- /.modal-content -->
		  </div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
		
		
		<!--Modal for Quality-->
		<div class="modal fade modal-wide" id="quality_modal" tabindex="-1" role="dialog" aria-labelledby="qualityRubric" aria-hidden="true" data-dismiss="false">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header teacher-header">
			        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			        <h4 class="modal-title">Quality</h4>
			      </div>
			      <div class="modal-body">
			        <form role="form" class="form-inline" id="quality_form">
							<div class="criteria-list">
									<ul col-lg-12>
										<li class="well well-small">Answer the prompt beyond a reasonable doubt
											<p>
											  <label for="grade2">Grade:</label>
											  <input type="text" id="grade2" style="border:0; color:#f6931f; font-weight:normal;">
											</p>
											<div id="grade-slider2" class="grade-slider"></div>
										</li>
									</ul>
								</div>
								
								<div class="modal-footer">
								  <input type="reset" class="btn btn-default" data-dismiss="modal" value="Close"/>
								  <input type="submit" class="btn btn-primary" value="Save" id="btnSave"/>
								</div>
								
							</form>
			      </div>
			      
			    </div><!-- /.modal-content -->
			  </div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
		
		<!--Modal for Content-->
		<div class="modal fade modal-wide" id="content_modal" tabindex="-1" role="dialog" aria-labelledby="contentRubric" aria-hidden="true" data-dismiss="false">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header teacher-header">
			        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			        <h4 class="modal-title">Content</h4>
			      </div>
			      <div class="modal-body">
			        <form role="form" class="form-inline" id="content_form">
								<div class="criteria-list">
										<ul col-lg-12>
											<li class="well well-small">Answer the prompt beyond a reasonable doubt
												<p>
												  <label for="grade3">Grade:</label>
												  <input type="text" id="grade3" style="border:0; color:#f6931f; font-weight:normal;">
												</p>
												<div id="grade-slider3" class="grade-slider"></div>
											</li>									
										</ul>
									</div>
									
									<div class="modal-footer">
									  <input type="reset" class="btn btn-default" data-dismiss="modal" value="Close"/>
									  <input type="submit" class="btn btn-primary" value="Save" id="btnSave"/>
									</div>
									
								</form>
			      </div>
			      
			    </div><!-- /.modal-content -->
			  </div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
		
		<!--Modal for Process-->
		<div class="modal fade modal-wide" id="process_modal" tabindex="-1" role="dialog" aria-labelledby="processRubric" aria-hidden="true" data-dismiss="false">
			  <div class="modal-dialog">
			    <div class="modal-content">
			      <div class="modal-header teacher-header">
			        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
			        <h4 class="modal-title">Process</h4>
			      </div>
			      <div class="modal-body">
			        <form role="form" class="form-inline" id="process_form">
								<div class="criteria-list">
										<ul col-lg-12>
											<li class="well well-small">Answer the prompt beyond a reasonable doubt
												<p>
												  <label for="grade4">Grade:</label>
												  <input type="text" id="grade4" style="border:0; color:#f6931f; font-weight:normal;">
												</p>
												<div id="grade-slider4" class="grade-slider"></div>
											</li>
										</ul>
									</div>
									
									<div class="modal-footer">
									  <input type="reset" class="btn btn-default" data-dismiss="modal" value="Close"/>
									  <input type="submit" class="btn btn-primary" value="Save" id="btnSave"/>
									</div>
									
								</form>
			      </div>
			      
			    </div><!-- /.modal-content -->
			  </div><!-- /.modal-dialog -->
			</div><!-- /.modal -->
			
			<!--Modal for Objective-->
			<div class="modal fade modal-wide" id="objective_modal" tabindex="-1" role="dialog" aria-labelledby="objectiveRubric" aria-hidden="true" data-dismiss="false">
				  <div class="modal-dialog">
				    <div class="modal-content">
				      <div class="modal-header teacher-header">
				        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				        <h4 class="modal-title">Objective</h4>
				      </div>
				      <div class="modal-body">
								
								<h5>{# assignment_name #}</h5>
								<p class="text-scroll"><b>Description:</b> {# assignment_description #}</p>
								<p><b>Max Points:</b> out of 100</p>
								<p><b>Category:</b> {# assignment_category #}</p>
								<p><b>Grading Criteria:</b> {# rubric_name #}</p>
								<p><b>Due Date:</b> {# due_date #}</p>			
										
								<div class="modal-footer">
								  <input type="reset" class="btn btn-default" data-dismiss="modal" value="Close"/>
								  <!--<input type="submit" class="btn btn-primary" value="Save" id="btnSave"/>-->
								</div>
										
				      </div>
				      
				    </div><!-- /.modal-content -->
				  </div><!-- /.modal-dialog -->
				</div><!-- /.modal -->
	
					
				<!--Modal for Objective-->
				<div class="modal fade" id="criteria_modal" tabindex="-1" role="dialog" aria-labelledby="criteriaModal" aria-hidden="true" data-dismiss="false">
					  <div class="modal-dialog">
					    <div class="modal-content">
					      <div class="modal-header teacher-header">
					        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					        <h4 class="modal-title">Criteria Details</h4>
					      </div>
					      <div class="modal-body">
									
									<h5>{# criteria_name #}</h5>
			
											
									<div class="modal-footer">
									  <input type="reset" class="btn btn-default" data-dismiss="modal" value="Close"/>
									  <!--<input type="submit" class="btn btn-primary" value="Save" id="btnSave"/>-->
									</div>
											
					      </div>
					      
					    </div><!-- /.modal-content -->
					  </div><!-- /.modal-dialog -->
					</div><!-- /.modal -->
	
	
<div id="divedithighlight" style="z-index:2;width:500px;position:absolute;background-color:white;margin-top:10%;margin-left:35%;padding:10px;">
	<table style="width:100%;">
        <tr>
            <td>Category:</td>
            <td><select id="ele_highlightCategory">
                <option value="">Please Select</option>
                {% for row in categoryentity %}
					<option value="{{ row.categoryid.id }}">{{ row.categoryid.name }}</option>
				{% endfor %}
                </select>
            </td>
        </tr>
		<tr>
			<td>Tag:</td>
			<td id="tdtag">
				<input id="ele_highlightTag" type="text" name="tag[]" value="" class="tag" style="width:420px;"/>
			</td>
			<td id="tdtagdisplay">
				<label id="ele_highlightTagDisplay"></label>
			</td>
		</tr>
		<tr class="editHighlightSuggest">
			<td>Suggest tags:</td>
			<td>
				<select id="ele_suggestTags" size="4"></select>
			</td>
		</tr>
		<tr>
			<td style="vertical-align:top;">Comment:</td>
			<td><textarea id="ele_highlightComment" style="width:420px;height:100px;resize:none;"></textarea></td>
		</tr>
		<tr id="viewhighlight">
			<td colspan="2" style="text-align:center;">
				<input id="btnedithighlight" type="button" class="button btn btn-default" style="width:80px;" value="Edit">&nbsp;
				<input id="btncloseedithighlight" type="button" class="button btn btn-default" style="width:80px;" value="Close">
			</td>
		</tr>
		<tr id="edithighlight">
			<td colspan="2" style="text-align:center;">
				<input id="btnsavehighlight" type="button" class="button btn btn-default" style="width:80px;" value="Save">&nbsp;
				<input id="btndeletehighlight" type="button" class="button btn btn-default" style="width:80px;" value="Delete">&nbsp;
				<input id="btncancelhighlight" type="button" class="button btn btn-default" style="width:80px;" value="Cancel">
			</td>
		</tr>
	</table>
</div>
<style>
#tagBox { 
	background-color:#575454;
 	text-align:center;
 	padding:5px;
 	overflow:auto;
 	font-size:70%;
 	font-family:arial;
}
#tagBox h2 { 
	font-size:2.5em; 
	margin:0 0 10px -150px; 
}
#tagList { margin:0; padding:0; }
#tagList li { list-style-type:none; float:left; margin:0 10px; height:35px; }
#tagList li a { text-decoration:none;}
#tagList li a:hover { text-decoration:underline; }
</style>
	<script>
		$(window).load(function () {
			openDynamicLesson();
		});
		$('#tag-details').click(function () {
			openDynamicLesson();
		});
		
		$('.circle').click(function () {
			$('#criteriaList').removeClass('hide');
		});
		
		function openDynamicLesson() {
			$('#lessonSmall').toggle(1000, 'easeOutExpo');
			$('#lessonSmall').css('display', 'block').css('z-index', '99999');	
		}
		$('#lessonSmall .close').click(function () {
			openDynamicLesson();
		});
		
		$(document).ready(function () {
			$(function() {
			    $( "#grade-slider1" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade1" ).val( ui.value );
			      }
			    });
			    $( "#grade1" ).val( $( "#grade-slider1" ).slider( "value" ) );
			  });
			  
			$(function() {
			    $( "#grade-slider2" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade2" ).val( ui.value );
			      }
			    });
			    $( "#grade2" ).val( $( "#grade-slider2" ).slider( "value" ) );
			  });
			
			$(function() {
			    $( "#grade-slider3" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade3" ).val( ui.value );
			      }
			    });
			    $( "#grade3" ).val( $( "#grade-slider3" ).slider( "value" ) );
			  });
			  
			$(function() {
			    $( "#grade-slider4" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade4" ).val( ui.value );
			      }
			    });
			    $( "#grade4" ).val( $( "#grade-slider4" ).slider( "value" ) );
			  });
			
			$("[rel=popover]").popover();
		});		
	</script>
</body>
</html>