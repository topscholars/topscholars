{% load staticfiles %} 
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8"/>
<!--        <link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/Prototype.css' %}" />
        <link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/smoothness/jquery-ui-1.10.3.custom.min.css' %}" />
        <link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/jquery.tagedit.css' %}" />
        <script src="{% static 'tsweb/js/jQuery1.10.1.js' %}"></script>
        <script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>
        <script src="{% static 'tsweb/js/jquery.cookie.js' %}"></script>
        <script src="{% static 'tsweb/js/jquery.json-2.4.min.js' %}"></script>
        <script src="{% static 'tsweb/js/util.js' %}"></script>
        <script src="{% static 'tsweb/js/jquery.autoGrowInput.js' %}"></script>
        <script src="{% static 'tsweb/js/jquery.tagedit.js' %}"></script>-->
<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/smoothness/jquery-ui-1.10.3.custom.min.css' %}"/>
<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/jquery.tagedit.css' %}"/>
<link rel="stylesheet" href="{% static 'tsweb/css/bootstrap.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'tsweb/css/bootstrap-glyphicons.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'tsweb/css/topscholars.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'tsweb/css/redactor.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'tsweb/css/jquery.comment.css' %}" type="text/css"/>
<link rel="stylesheet" href="{% static 'tsweb/css/slider.css' %}" type="text/css"/>
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<!--        <script src="{% static 'tsweb/js/jQuery1.10.1.js' %}"></script>
        <script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>-->
<script src="{% static 'tsweb/js/jQuery1-10-1.js' %}" type="text/javascript"></script>
<script src="{% static 'tsweb/js/WaterMark.js' %}"></script>
<script src="{% static 'tsweb/js/bootstrap.js' %}" type="text/javascript"></script>
<script src="{% static 'tsweb/js/popover.js' %}" type="text/javascript"></script>
<script src="{% static 'tsweb/js/tooltip.js' %}" type="text/javascript"></script>
<script src="{% static 'tsweb/js/transition.js' %}" type="text/javascript"></script>
<script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>
<script src="{% static 'tsweb/js/jquery.cookie.js' %}"></script>
<script src="{% static 'tsweb/js/util.js' %}"></script>
<script src="{% static 'tsweb/js/redactor.min.js' %}"></script>
<script src="{% static 'tsweb/js/jquery.comment.js' %}"></script>
<script src="{% static 'tsweb/js/jquery.autoGrowInput.js' %}"></script>
<script src="{% static 'tsweb/js/jquery.tagedit.js' %}"></script>
<script src="{% static 'tsweb/js/fontcolor.js' %}"></script>
<script src="{% static 'tsweb/js/fontfamily.js' %}"></script>
<script src="{% static 'tsweb/js/fontsize.js' %}"></script>
<script src="{% static 'tsweb/js/jquery.validate.js' %}"></script>
<script src="{% static 'tsweb/js/bootstrap-slider.js' %}"></script>
<!--DELETE BEFORE DEPLOYMENT-->
<!--<link rel="stylesheet" href="../../../static/tsweb/css/bootstrap.css" type="text/css"/>
<link rel="stylesheet" href="../../../static/tsweb/css/topscholars.css" type="text/css"/>
<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css"/>
<link rel="stylesheet" href="../../../static/tsweb/css/redactor.css"/>
<link rel="stylesheet" href="../../../static/tsweb/css/jquery.comment.css"/>

<!--<link rel="stylesheet" href="../../../static/tsweb/css/redactor-iframe.css" />--*>
<!--<script src="{% static 'tsweb/js/jQuery1.10.1.js' %}"></script>--*>
<!--<script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>--*>
<script src="../../../static/tsweb/js/jQuery1-10-1.js" type="text/javascript"></script>
<script src="../../../static/tsweb/js/jquery-ui-1-10-3-custom-min.js" type="text/javascript"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<script src="../../../static/tsweb/js/bootstrap.js" type="text/javascript"></script>
<script src="../../../static/tsweb/js/transition.js" type="text/javascript"></script>
<script src="../../../static/tsweb/js/popover.js" type="text/javascript"></script>
<script src="../../../static/tsweb/js/tooltip.js" type="text/javascript"></script>
<script src="../../../static/tsweb/js/redactor.min.js" type="text/javascript"></script>
<script src="../../../static/tsweb/js/jquery.comment.js" type="text/javascript"></script>
<script src="../../../static/tsweb/js/jquery-touch-punch.min.js" type="text/javascript"></script>-->
<!--==============================================-->
<script>
            //$(document).ready(function () {
                
            //    $("#commentSection").comments({
            //         getCommentsUrl: "/JqComment/GetComments",
            //         postCommentUrl: "/JqComment/PostComment",
            //         deleteCommentUrl: "/JqComment/DeleteComment",
            //    });
                
            //    $("[rel=popover]").popover();
            //});
        </script>
</head>
<body>
<script>
    var submissionreviewerid;
    var highlightid;
    var doccommentid;
    function EDITTABLE() {
        var thisClass = this;
        var evalClass = 'SUBMISSIONREVIEW';
        var url = "{% url 'tsweb:tprocessajax' %}";
        var formValidate = $("#submit_block_form");

        this.getCommentPos = function (id) {
            $(".essayhighlight").css({ 'background': 'red' });
            $('inline[name="' + id + '"]').css({ 'background': '#ffff00' });
        }
        
        this.categoryHighlightList = function (name) {
            var categoryid = 0;
            switch (name) {
                case "impact":
                    categoryid = 1;
                    break;
                case "quality":
                    categoryid = 2;
                    break;
                case "content":
                    categoryid = 3;
                    break;
                case "process":
                    categoryid = 4;
                    break;
            }
            var textComment = '';
            $.getJSON(
                    url,
                    {
                        'class': evalClass,
                        'method': 'tagCategoryHighlightList',
                        'categoryid': categoryid,
                        'submissionreviewerid': submissionreviewerid
                    },
                    function (result) {
                        $(".essayhighlight").css({ 'background': 'red' });
                        $.each(result, function (i, val) {
                            var spanid = val[0];
                            $('inline[name="' + spanid + '"]').css({ 'background': '#ffff00' });
                            textComment += "- " + val[1] + "<br/>";
                        });
                    }).error(function (xhr, status, error) {
                        alert('Error occur. Please contact the administrator.');
                    });
        }
        this.tagClickHighlightList = function (id) {
            var textComment = '';
            $.getJSON(
                    url,
                    {
                        'class': evalClass,
                        'method': 'tagClickHighlightList',
                        'taglinkid': id,
                        'submissionreviewerid': submissionreviewerid
                    },
                    function (result) {
                        $(".essayhighlight").css({ 'background': 'red' });
                        $.each(result, function (i, val) {
                        	
                            var spanid = val[0];
                            $('inline[name="' + spanid + '"]').css({ 'background': val[2] });
                            textComment += "- " + val[1] + "<br/>";
                        });
                    }).error(function (xhr, status, error) {
                        alert('Error occur. Please contact the administrator.');
                    });
        }
        this.tagHighlightList = function () {
            $.getJSON(
                url,
                {
                    'class': evalClass,
                    'method': 'tagHighlightList',
                    'submissionreviewerid': submissionreviewerid
                },
                function (result) {
                    $("#tagList li").remove();
                    $("#Ul1").html('');
                    $("#commentArea").val('');
                    $("<ul>").attr("id", "tagList").appendTo("#Ul1");
                    if (result.length > 0) {
                        $.each(result, function (i, val) {
                            var li = $("<li class='tag'>");
                            //create link
                            $("<a>").text(val[1] + "(" + val[3] + ")").attr({ "data-id": val[0], href: "#", class: "tagClickHighlightList" }).appendTo(li);
                            //set tag size
                            if (val[2] == 0) {
                                li.children().css({ 'font-size': '1.5em', 'font-weight': 'bold' });
                            } else {
                                li.children().css({ 'font-size': '1.2em' });
                            }
                            //add to list
                            li.appendTo("#tagList");
                        });
                    } else {
                        $("#tagList").height('50');
                    }
                    $(".tagClickHighlightList").click(function () {
                        var id = $(this).data("id");
                        thisClass.tagClickHighlightList(id);
                        return false;
                    });
                }).error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
        }
        this.getData = function () {
            $.getJSON(
                url,
                {
                    'class': 'SUBMISSIONREVIEW',
                    'method': 'getSubmissionReviewer',
                    'submissionreviewerid': submissionreviewerid
                },
                function (result) {
                    $('#ele_submissionversionessay').redactor('set', result.essay);

                    $(".impact_criteria").val(result.Impact);
                    $("#impact_percent").text(result.Impact+" %");
                    
                    $(".quality_criteria").val(result.Quality);
                    $("#quality_percent").text(result.Quality+" %");
                    
                    $(".content_criteria").val(result.Content);
                    $("#content_percent").text(result.Content+" %");
                    
                    $(".process_criteria").val(result.Process);
                    $("#process_percent").text(result.Process+" %");
                    
                    $(".rubriclinkId").val(result.rubriclinkid)

                    if (result.status == 0) {
                        $('#btnedithighlight').show();
                        $('#saveAssignment').show();
                        $('#btnStpSave').show();
                        thisClass.accessSaveRubric = true;
                    }
                    else {
                        $('#btnedithighlight').hide();
                        $('#saveAssignment').hide();
                        $('#btnStpSave').hide();
                        $('#ele_submissionversionessay').unbind('mouseup');
                        thisClass.accessSaveRubric = false;
                    }
                    thisClass.tagHighlightList();
                })
                .error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
        }
        this.getSelectionCharOffsetsWithin = function (element) {
            var start = 0, end = 0;
            var sel, range, priorRange;
            if (typeof window.getSelection != "undefined") {
                range = window.getSelection().getRangeAt(0);
                priorRange = range.cloneRange();
                priorRange.selectNodeContents(element);
                priorRange.setEnd(range.startContainer, range.startOffset);
                start = priorRange.toString().length;
                end = start + range.toString().length;
            } else if (typeof document.selection != "undefined" &&
                    (sel = document.selection).type != "Control") {
                range = sel.createRange();
                priorRange = document.body.createTextRange();
                priorRange.moveToElementText(element);
                priorRange.setEndPoint("EndToStart", range);
                start = priorRange.text.length;
                end = start + range.text.length;
            }
            return {
                start: start,
                end: end
            };
        }
        this.essayEvent = function () {
            $('#ele_submissionversionessay').mouseup(function () {
                if (thisClass.getSelectionCharOffsetsWithin(this).start != thisClass.getSelectionCharOffsetsWithin(this).end) {
                    var redactor_object = $('#ele_submissionversionessay').redactor('getObject');
                    redactor_object.selectionSave();
                    thisClass.showHighlightDialog(true);
                }
            }).keypress(function (e) {
                return false;
            });
        }
        this.editHighlightDialog = function (edit) {
            if (edit) {
                $('#edithighlight').show();
                $('#viewhighlight').hide();
                $('#tdtagdisplay').hide();
                $('#tdtag').show();
                $('#ele_highlightTag').removeAttr("disabled");
                $('#ele_highlightComment').removeAttr("disabled");
                $('.tagedit-list').removeAttr("disabled");
                $('#ele_highlightCategory').removeAttr("disabled");
            }
            else {
                $('#edithighlight').hide();
                $('#viewhighlight').show();
                $('#tdtagdisplay').show();
                $('#tdtag').hide();
                $('#ele_highlightTag').attr("disabled", "disabled");
                $('#ele_highlightComment').attr("disabled", "disabled");
                $('#ele_highlightCategory').attr("disabled", "disabled");
            }
        }
        this.showHighlightDialog = function (show) {
            if (show) {
                $('#diveditbg').show();
                $('#divedithighlight').show();
                $('.editHighlightSuggest').hide();
                if (highlightid != '') {
                    thisClass.editHighlightDialog(false);
                    $('#btndeletehighlight').show();
                }
                else {
                    thisClass.editHighlightDialog(true);
                    $('#btndeletehighlight').hide();
                }
            }
            else {
                $('#diveditbg').hide();
                $('#divedithighlight').hide();
                highlightid = '';
                $('#ele_highlightTagDisplay').text('');
                $('.tagedit-listelement-old').remove();
                $('#ele_highlightComment').val('');
                $('#ele_highlightCategory').val('');
                var redactor_object = $('#ele_submissionversionessay').redactor('getObject');
                redactor_object.selectionRemoveMarkers();
            }
        }
        this.getHighlightDataTag = function () {
            var tagids = [];
            $.getJSON(
                url,
                {
                    'class': 'SUBMISSIONREVIEW',
                    'method': 'getSubmissionVersionHighlightTags',
                    'highlightid': highlightid
                },
                function (result) {
                    $(".tagedit-listelement-old").remove();
                    var displaytxt = '';
                    for (var i = 0; i < result.length; i++) {
                        tagids.push(result[i].id);
                        thisClass.addTagEditElement(result[i].name, result[i].id);
                        if (displaytxt != '')
                            displaytxt = displaytxt + ', '
                        displaytxt = displaytxt + result[i].name;
                    }
                    thisClass.tagEditCloseEvent();
                    thisClass.getSelectSuggest(tagids);
                    $('#ele_highlightTagDisplay').text(displaytxt);
                })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
        }
        this.getHighlightData = function () {
            $.getJSON(
                url,
                {
                    'class': 'SUBMISSIONREVIEW',
                    'method': 'getSubmissionVersionHighlight',
                    'highlightid': highlightid
                },
                function (result) {
                    $.each(result, function (ini, val) {
                        if ($('#ele_' + ini).is("span") || $('#ele_' + ini).is("div"))
                            $('#ele_' + ini).html(val);
                        else
                            $('#ele_' + ini).val(val);
                    });
                    thisClass.getHighlightDataTag();
                    thisClass.showHighlightDialog(true);
                })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
        }
        this.saveEditTags = function (tagids, method) {
            var odata;
            if (method == 'add') {
                odata = {
                    class: evalClass,
                    method: 'addSubmissionversionHighlight',
                    submissionreviewerid: submissionreviewerid,
                    highlightComment: $('#ele_highlightComment').val(),
                    tagids: tagids,
                    categoryid: $('#ele_highlightCategory').val()
                };

                $.post(url, odata,
                function (result) {
                    highlightid = result.recid;
                    var redactor_object = $('#ele_submissionversionessay').redactor('getObject');
                    redactor_object.selectionRestore();
                    redactor_object.inlineSetAttr({ 'name': result.recid, "style": "background-color:red;", "class": 'essayhighlight', "ondblclick": 'openHighlightDialog(' + result.recid + ')' });

                    redactor_object.sync();
                    odata = {
                        class: evalClass,
                        method: 'updateReviewerEssay',
                        submissionreviewerid: submissionreviewerid,
                        essay: $('#ele_submissionversionessay').redactor('getEditor').html()
                    };
                    $.post(url, odata,
                        function (result) {
                            thisClass.tagHighlightList();
                            thisClass.getHighlightData();
                            thisClass.getCommentlist();
                            thisClass.editHighlightDialog(false);
                        })
                    .error(function (xhr, status, error) {
                        alert('Error occur. Please contact the administrator.');
                    });
                })
                .error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
            } else if (method == 'save') {
                odata = {
                    class: evalClass,
                    method: 'saveSubmissionversionHighlight',
                    highlightid: highlightid,
                    highlightComment: $('#ele_highlightComment').val(),
                    tagids: tagids,
                    categoryid: $('#ele_highlightCategory').val()
                };

                $.post(url, odata,
                function (result) {
                    thisClass.tagHighlightList();
                    thisClass.getHighlightData();
                    thisClass.getCommentlist();
                    thisClass.editHighlightDialog(false);
                })
                .error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
            }
        }
        this.save = function () {
            var tagids = [];
            var i = 0;
            $('input[name*="-a"]').each(function (index) {
                var name = $(this).attr('name');
                name = name.replace('tag[', '');
                name = name.replace('-a]', '');
                tagids.push(name);
            });
            if (highlightid != '') {
                //update
                thisClass.saveEditTags(tagids, 'save');
            }
            else {
                //insert
                thisClass.saveEditTags(tagids, 'add');
            }
        }
        this.del = function () {
            var redactor_object = $('#ele_submissionversionessay').redactor('getObject');
            $('inline[name="' + highlightid + '"]').each(function () {
                redactor_object.selectionElement(this);
                redactor_object.inlineRemoveAttr('name');
                redactor_object.inlineRemoveAttr('ondblclick');
                redactor_object.inlineRemoveClass('essayhighlight');
                redactor_object.inlineRemoveStyle('background-color');
                redactor_object.inlineRemoveAttr('ondblclick');
                redactor_object.sync();
            });
            $.post(url,
                    {
                        'class': 'SUBMISSIONREVIEW',
                        'method': 'delete',
                        'submissionreviewerid': submissionreviewerid,
                        'highlightid': highlightid,
                        'essay': $('#ele_submissionversionessay').redactor('getEditor').html()
                    },
                    function (result) {
                        thisClass.showHighlightDialog(false);
                        thisClass.tagHighlightList();
                        thisClass.getCommentlist();
                    })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
        }
        this.tagEditCloseEvent = function () {
            $(".tagedit-close").unbind('click');
            $(".tagedit-close").click(function () {
                var tagElement = $(this).prev();
                var thisInput = tagElement.attr('name');
                thisInput = thisInput.replace('tag[', '');
                thisInput = thisInput.replace('-a]', '');
                var thisId = thisInput;
                var tagNewIds = [];
                $('input[name*="-a"]').each(function (index) {
                    var nameInput = $(this).attr('name');
                    nameInput = nameInput.replace('tag[', '');
                    nameInput = nameInput.replace('-a]', '');
                    if (nameInput != thisId) {
                        tagNewIds.push(nameInput);
                    }
                });
                thisClass.getSelectSuggest(tagNewIds);
            });
        }
        this.addTagEditElement = function (name, id) {
            var tagitem = '<li class="tagedit-listelement tagedit-listelement-old"><span dir="ltr">' + name + '</span><input type="hidden" name="tag[' + id + '-a]" value="' + name + '"><a class="tagedit-close" title="Remove from list.">x</a></li>'
            $(tagitem).insertBefore('.tagedit-listelement-new');
        }
        this.getSelectSuggest = function (tagids) {
            var option = '';
            if (tagids != "") {
                $.post(
                    url,
                    {
                        'class': evalClass,
                        'method': 'getSelectSuggest',
                        tagids: tagids
                    },
                    function (result) {
                        $("#ele_suggestTags option").remove();
                        option += '<option value="">Suggest Tag</option>';
                        $.each(result, function (ini, val) {
                            option += '<option value="' + val.id + '">' + val.label + '</option>';
                        });
                        $("#ele_suggestTags").append(option);
                        $("#ele_suggestTags").unbind('dblclick');
                        $("#ele_suggestTags").change(function () {
                            var id = $(this).val();
                            if (id != "") {
                                var name = $("#ele_suggestTags option:selected").text();
                                $("#ele_suggestTags option[value='" + id + "']").remove();
                                thisClass.addTagEditElement(name, id);
                                var tagNewIds = [];
                                $('input[name*="-a"]').each(function (index) {
                                    var nameInput = $(this).attr('name');
                                    nameInput = nameInput.replace('tag[', '');
                                    nameInput = nameInput.replace('-a]', '');
                                    tagNewIds.push(nameInput);
                                });
                                thisClass.tagEditCloseEvent();
                                thisClass.getSelectSuggest(tagNewIds);
                            }
                        });
                    }).error(function (xhr, status, error) {
                        alert('Error occur. Please contact the administrator.');
                    });
            } else {
                $("#ele_suggestTags option").remove();
                $(".editHighlightSuggest").hide();
            }
        }
        this.showSubmitDialog = function (show) {
            if (show) {
                $('#diveditbg').show();
                $('#submitpopup').show();
            }
            else {
                $('#diveditbg').hide();
                $('#submitpopup').hide();
            }
        }
        this.submit = function () {
            //thisClass.showSubmitDialog(true);
            $(".submit_criteria").each(function(){
                    id = $(this).attr('id');
                    value = $(this).val();
                    criteriaid.push(id);
                    criteriaval.push(value);
            });
            odata = {'class' :  'SUBMISSIONREVIEW',
                     'method' : 'submit',
                     'submissionreviewerid': submissionreviewerid,
                     //'stage' : $("#submit_stage").val(),
                     //'comment' : $("#submit_comment").val(),
                     //'progress' : $("#submit_progress").val(),
                     'impact': $(".impact_criteria").val(),
                     'quality': $(".quality_criteria").val(),
                     'content': $(".content_criteria").val(),
                     'process': $(".process_criteria").val()
                     };
            $.post(url,odata,
                    function(result){
                    		thisClass.saveRubriclink();
                            window.location = "{% url 'tsweb:tsubmissionlist' %}";
                    })
            .error(function(xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
            });
        }
        
        this.initValidateForm = function(){
			  formValidate.validate({              
			    rules: {
			      	progress:{
			      		required: true,
			      		number: true,
			      	},
			    },
				 invalidHandler: function(event, validator) {
				// 'this' refers to the form
					thisClass.submitForm = false;
				}
			  });
	    }
	
		this.initValidateFormEvent = function(){
			thisClass.submitForm = true;
		  	formValidate.validate().form();
		}
		
		this.resetValidatForm = function(){
			var validator = formValidate.validate();
			validator.resetForm();
			$(".error").removeClass('error');	
		}
		this.getCommentlist = function () {
		    odata = {
		        'class': 'SUBMISSIONREVIEW',
		        'method': 'getCommentlist',
		        'submissionreviewerid': submissionreviewerid
		    };
		    $.getJSON(url, odata,
                    function (result) {
                        $('#comment-list').html('');
                        var html = '';
                        for (var i = 0; i < result.length; i++) {
                            if (result[i].entityid == 5) {
                                html += '<li id="' + result[i].id + '">';
                                html += '<i class="fa fa-file" data-toggle="tooltip" data-trigger="hover" data-placement="left" rel="tooltip" title data-original-title="Document based" data-container="body"></i>&nbsp;&nbsp;';
                            }
                            else {
                                html += '<li id="' + result[i].id + '" onclick="getCommentPos(' + result[i].id + ');" style="cursor:pointer;">';
                                html += '<i class="fa fa-compass" data-toggle="tooltip" data-trigger="hover" data-placement="left" rel="tooltip" title data-original-title="Location based" data-container="body"></i>&nbsp;&nbsp;';
                            }
                                        
                            html += '<i>' + result[i].creator + ' - </i>';
                            html += '<span class="commentvalue">' + result[i].comment + '</span> <br /> <time class="commentDate">' + result[i].createddt + '</time>';
                            if (result[i].entityid == 5) {
                                html += '&nbsp;<a type="submit" onclick="editComment(' + result[i].id + ');" style="cursor:pointer;">Edit</a>&nbsp;<a type="submit" onclick="delComment(' + result[i].id + ');" style="cursor:pointer;">Delete</a>';
                            }
                            html += '</li>';
                        }
                        $('#comment-list').html(html);
                    })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
		}
		this.addComment = function () {
		    var comment = $('#comment').val();
		    if (comment != "") {
		        odata = {
		            'class': 'SUBMISSIONREVIEW',
		            'method': 'addComment',
		            'submissionreviewerid': submissionreviewerid,
		            'comment': comment
		        };
		        $.post(url, odata,
                        function (result) {
                            thisClass.getCommentlist();
                            $('#comment').val('');

                            doccommentid = '';
                        })
                .error(function (xhr, status, error) {
                    alert('Error occur. Please contact the administrator.');
                });
		    }
		}
		this.delComment = function (id) {
		    odata = {
		        'class': 'SUBMISSIONREVIEW',
		        'method': 'delComment',
		        'textcommentid': id
		    };
		    $.post(url, odata,
                    function (result) {
                        thisClass.getCommentlist();
                    })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
		}
		this.getCommentDetails = function () {
		    odata = {
		        'class': 'SUBMISSIONREVIEW',
		        'method': 'getCommentlist',
		        'submissionreviewerid': submissionreviewerid
		    };
		    $.getJSON(url, odata,
                    function (result) {
                        $('#comment-list').html('');
                        var html = '';
                        for (var i = 0; i < result.length; i++) {
                            if (result[i].entityid == 5) {
                                html += '<li id="' + result[i].id + '">';
                                html += '<i class="fa fa-file" data-toggle="tooltip" data-trigger="hover" data-placement="left" rel="tooltip" title data-original-title="Document based" data-container="body"></i>&nbsp;&nbsp;';
                            }
                            else {
                                html += '<li id="' + result[i].id + '" onclick="getCommentPos(' + result[i].id + ');" style="cursor:pointer;">';
                                html += '<i class="fa fa-compass" data-toggle="tooltip" data-trigger="hover" data-placement="left" rel="tooltip" title data-original-title="Location based" data-container="body"></i>&nbsp;&nbsp;';
                            }

                            html += '<i>' + result[i].creator + ' - </i>';
                            html += '<span class="commentvalue">' + result[i].comment + '</span> <br /> <time class="commentDate">' + result[i].createddt + '</time>';
                            if (result[i].entityid == 5) {
                                html += '&nbsp;<a type="submit" onclick="editComment(' + result[i].id + ');" style="cursor:pointer;">Edit</a>&nbsp;<a type="submit" onclick="delComment(' + result[i].id + ');" style="cursor:pointer;">Delete</a>';
                            }
                            html += '</li>';
                        }
                        $('#comment-list').html(html);

                        var comment = $('#comment-list').find('#' + doccommentid).find('span').html();
                        $('#comment-list').find('#' + doccommentid).find('span').replaceWith($('<textarea>').val(comment));
                        $('#comment-list').find('#' + doccommentid).find('textarea').keypress(function (event) {
                            if (event.keyCode == 13) {
                                comment = $('#comment-list').find('#' + doccommentid).find('textarea').val();

                                odata = {
                                    'class': 'SUBMISSIONREVIEW',
                                    'method': 'editComment',
                                    'textcommentid': doccommentid,
                                    'comment': comment
                                };
                                $.post(url, odata,
                                        function (result) {
                                            $('#comment-list').find('#' + doccommentid).find('textarea').replaceWith($('<span>').addClass('commentvalue').html(comment));
                                            doccommentid = '';
                                        })
                                .error(function (xhr, status, error) {
                                    alert('Error occur. Please contact the administrator.');
                                });
                            }
                        });
                    })
            .error(function (xhr, status, error) {
                alert('Error occur. Please contact the administrator.');
            });
		}
		
		this.getRubricCriteria = function(){
		    odata = {
		        'class': 'SUBMISSIONREVIEW',
		        'method': 'getRubricCriteria',
		        'submissionreviewerid': submissionreviewerid
		    };
		    $.getJSON(url, odata,
		    	function(result){
					
		    		$.each(result, function (i, val) {
		    			if(val.value == null){
		    				value = 0;
		    			}else{
		    				value = val.value;
		    			}
		    			html = '<div class="form-group">';
		    			html += '<label for="sliderCriteria">'+val.criteria+'</label><br>';
		    			html += '<input type="text" data-id="'+val.criteriaid+'" class="form-control sliderCriteria">';
		    			html += '<input type="hidden" data-id="'+val.criteriaid+'" class="criteriaValue" value="'+value+'">';
		    			html += '<input type="hidden" data-id="'+val.criteriaid+'" class="criteriaWeight" value="'+val.weight+'">';
		    			html += '<input type="hidden" data-id="'+val.criteriaid+'" class="criteriaMax" value="'+val.max+'">';
		    			html += '</div>';
		    			
		    			$(".categoryRubricScale[data-id='"+val.categoryid+"']").append(html);
		    			
			            $(".sliderCriteria[data-id='"+val.criteriaid+"']").slider({
			            	orientation: 'horizontal',
			            	min:0,
			            	max:val.max,
			            	value:value,
			            	width:250,
			            	scale:true,
			            });
		    		});
		    		
		    		
					$(".categoryRubricScale").each(function(i,v){
						categoryid = $(this).data('id');
						//thisClass.calculateActualWeight(categoryid);
		    			actualWeight =  $(".actualWeight[data-id='"+categoryid+"']").val();
		    			thisClass.calculateTotalScore(categoryid, actualWeight);
					});
					
		    		
		    		//event when slider
		    		$(".sliderCriteria").on('slideStop',function(){
		    			criteriaid = $(this).data('id');
		    			categoryid = $(this).parents('.categoryRubricScale').data('id');
		    			$(".criteriaValue[data-id='"+criteriaid+"']").val($(this).slider('getValue').val());
		    			
		    			thisClass.calculateActualWeight(categoryid);
		    			
		    			actualWeight =  $(".actualWeight[data-id='"+categoryid+"']").val();
		    			
		    			thisClass.calculateTotalScore(categoryid, actualWeight);

		    		});
		    	}
		    );
		}
		
		this.getCategoryTotalWeight = function(){
			odata = {	
		        'class': 'SUBMISSIONREVIEW',
		        'method': 'getCategoryTotalWeight',
		        'submissionreviewerid': submissionreviewerid
			}
			$.getJSON(url, odata, function(result){
				thisClass.CategoryTotalWeight = result;
			});
		}
		
		this.calculateTotalScore = function(categoryid, actualWeight){
			//summary totalweight
			var categoryTotalWeightSelect;
			summaryTotalWeight = 0;
			$.each(thisClass.CategoryTotalWeight,function(i,v){
				summaryTotalWeight += parseInt(v.totalweight);
				if(v.categoryid == categoryid)
					categoryTotalWeightSelect = i;
			});
			
			if(categoryTotalWeightSelect !== undefined){
				categoryTotalWeight = thisClass.CategoryTotalWeight[categoryTotalWeightSelect].totalweight;
				categoryTotalScore = actualWeight * categoryTotalWeight / summaryTotalWeight;
				$(".totalScore[data-id='"+categoryid+"']").val(categoryTotalScore);
			}
		}
		
		this.calculateActualWeight = function(categoryid){
			sumWeight = 0;
			//summary weight
			$(".categoryRubricScale[data-id='"+categoryid+"'] .criteriaWeight").each(function(i, v){
				sumWeight += parseInt($(this).val());
			});
			actualWeight = 0;
			$(".categoryRubricScale[data-id='"+categoryid+"'] .sliderCriteria").each(function(i, v){
				criteriaid = $(this).data('id');
				criteriaValue = $(".criteriaValue[data-id='"+criteriaid+"']").val();
				max = $(".criteriaMax[data-id='"+criteriaid+"']").val();
				weight = $(".criteriaWeight[data-id='"+criteriaid+"']").val();
				if(criteriaValue == '')
					criteriaValue = 0;
				
				actualWeight += ((criteriaValue/max) * 100 * (weight / sumWeight) * 100) /100 ;
			});

			$(".actualWeight[data-id='"+categoryid+"']").val(parseInt(actualWeight));
		}
		
		this.saveRubriclink = function(){
			thisClass.saveRubriclinkTotalScore();
			$(".categoryRubricScale").each(function(i,v){
				categoryid = $(this).data('id');
				
    			$(".categoryRubricScale[data-id='"+categoryid+"'] .sliderCriteria").each(function(i, v){
    				criteriaid = $(this).data('id');
    				criteriaValue = $(".criteriaValue[data-id='"+criteriaid+"']").val();
    				max = $(".criteriaMax[data-id='"+criteriaid+"']").val();
    				weight = $(".criteriaWeight[data-id='"+criteriaid+"']").val();
    				if(criteriaValue == '')
    					criteriaValue = 0;
    					
    				thisClass.saveRubriclinkSelectScale(criteriaid, criteriaValue);
    			});
				
			});
		}
		
		this.saveRubriclinkSelectScale = function(criteriaid, criteriaValue)
		{
		    odata = {
		        'class': 'SUBMISSIONREVIEW',
		        'method': 'saveRubriclinkSelectScale',
		        'rubriclinkid': $(".rubriclinkId").val(),
		        'criteriaid': criteriaid,
		        'criteriaValue': criteriaValue,
		    };
            $.ajax({
                    type: "POST",
                    url: url,
                    dataType: "json",
                    async: false,
                    data:odata
                 });
		}
		
		this.saveRubriclinkTotalScore = function(){
			totalscore = 0;
			$(".totalScore").each(function(i,v){
				totalscore += parseInt($(this).val());
			});
			odata = {
		        'class': 'SUBMISSIONREVIEW',
		        'method': 'saveRubriclinkTotalScore',
		        'rubriclinkid': $(".rubriclinkId").val(),
		        'submissionreviewerid': submissionreviewerid,
		        'totalscore': totalscore
	      	};
            $.ajax({
                type: "POST",
                url: url,
                dataType: "json",
                async: false,
                data:odata
             });
		}
		
        this.initContent = function () {
            submissionreviewerid = '{{ id }}';
            $('#ele_submissionversionessay').redactor({ toolbar: false });
            $('#tdtag input.tag').tagedit({
                autocompleteURL: "{% url 'tsweb:gettags' 5 %}",
                autocompleteOptions: { minLength: 1 },
                allowEdit: false
            });
            
            $('#btnedithighlight').click(function () {
                thisClass.editHighlightDialog(true);
                $('.editHighlightSuggest').show();
            });
            
            $('#btnsavehighlight').click(function () {
                thisClass.save();
                thisClass.editHighlightDialog(false);
            });

            $('#close_tag_list').click(function () {
                thisClass.showHighlightDialog(false);
            });

            $('#btndeletehighlight').click(function () {
                thisClass.del();
            });
            $('#saveAssignment').click(function () {
            	//thisClass.resetValidatForm();
                //thisClass.showSubmitDialog(true);
                thisClass.submit();
            });
            $("#btncancelsubmit").click(function () {
                thisClass.showSubmitDialog();
            });
            $("#btnsavesubmit").click(function () {
            	thisClass.initValidateFormEvent();
	            if(thisClass.submitForm){
					thisClass.submit();
				}
            });
            $('#ele_submissionversionversion').change(function () {
                if ($('#ele_submissionversionversion').val() != '') {
                    submissionreviewerid = $('#ele_submissionversionversion').val();
                    thisClass.getData();
                }
            });
            $(document).on('click', '.ui-menu-item', function () {
                $('.editHighlightSuggest').show();
                var tagNewIds = [];
                $('input[name*="-a"]').each(function (index) {
                    var nameInput = $(this).attr('name');
                    nameInput = nameInput.replace('tag[', '');
                    nameInput = nameInput.replace('-a]', '');
                    tagNewIds.push(nameInput);
                });
                thisClass.tagEditCloseEvent();
                thisClass.getSelectSuggest(tagNewIds);
            });
            $('.rubric-impact').click(function () {
                thisClass.categoryHighlightList("impact");
            });
            $('.rubric-quality').click(function () {
                thisClass.categoryHighlightList("quality");
            });
            $('.rubric-content').click(function () {
                thisClass.categoryHighlightList("content");
            });
            $('.rubric-process').click(function () {
                thisClass.categoryHighlightList("process");
            });
            $('#sent-comment').attr('href', 'javascript:var gen = new EDITTABLE();gen.addComment();');

            $('#btnStpSave, #exitBtn').click(function () {
                $(".submit_criteria").each(function () {
                    id = $(this).attr('id');
                    value = $(this).val();
                    criteriaid.push(id);
                    criteriaval.push(value);
                });
                odata = {
                    'class': 'SUBMISSIONREVIEW',
                    'method': 'stpsave',
                    'submissionreviewerid': submissionreviewerid,
                    'impact': $(".impact_criteria").val(),
                    'quality': $(".quality_criteria").val(),
                    'content': $(".content_criteria").val(),
                    'process': $(".process_criteria").val()
                };
                if(thisClass.accessSaveRubric){
	                $.post(url, odata,
	                        function (result) { 
                        		thisClass.saveRubriclink();
	                            window.location = "{% url 'tsweb:tsubmissionlist' %}";
	                        })
	                .error(function (xhr, status, error) {
	                    alert('Error occur. Please contact the administrator.');
	                });
                }else{
                	window.location = "{% url 'tsweb:tsubmissionlist' %}";
                }
                
                
                return false;
            });
            
            $(".actualWeight").change(function(){
            	categoryid = $(this).data('id');
    			$(".categoryRubricScale[data-id='"+categoryid+"'] .sliderCriteria").each(function(i, v){
					$(this).slider('setValue', 0);
    			});
            });
            
    	    $('#show_rubric_btn').click(function () {
		        $(this).addClass('hide');
		        $('.rubric-categories-sm').removeClass('hide');
		        $('.impact-list').addClass('hide');
		        $('.quality-list').addClass('hide');
		        $('.content-list').addClass('hide');
		        $('.process-list').addClass('hide');
		        $('.objective-list').addClass('hide');
		        
		        $(".actualWeight").each(function(){
		        	categoryid = $(this).data('id');
		        	value = $(this).val();
		        	
		        	$(".categoryWeightPercent[data-id='"+categoryid+"']").text(value+" %");
		        });
		    });

            thisClass.initValidateForm();
            thisClass.essayEvent();
            thisClass.showHighlightDialog(false);
            thisClass.getData();
            thisClass.getCategoryTotalWeight();
            thisClass.getRubricCriteria();
        }
    }
    $(function () {
        var gen = new EDITTABLE();
        gen.initContent();
    });
    function openHighlightDialog(id) {
        var gen = new EDITTABLE();
        highlightid = id;
        gen.getHighlightData();
    }
    function getCommentPos(id) {
        var gen = new EDITTABLE();
        gen.getCommentPos(id);
    }
    function delComment(id) {
        var gen = new EDITTABLE();
        gen.delComment(id);
    }
    function editComment(id) {
        var gen = new EDITTABLE();
        doccommentid = id;
        gen.getCommentDetails();
    }
</script>
{% include "tsweb/main/navbar.html" %}
<!-- End Nav -->
<!-- submit block -->

<form role="form" class="form-horizontal" id="submit_block_form">
<div id="diveditbg" style="display: none; background-color:gray;z-index:1;width:100%;height:100%;position:absolute;opacity:0.4;">
</div>
<div id="submitpopup" class="tag-list-dropdown" style="z-index:2;width:500px;position:absolute;margin-top:10%;margin-left:35%;padding:10px;display:none; color: white;">
	<div class="form-group">
		<label for="submit_stage" class="col-sm-4 control-label">Stage :</label>
		<div class="col-sm-8">
			<select id="submit_stage">
				 {% for row in selectionlist %}
				<option value="{{ row.selectionvalue }}">Revision {{ row.selectionname }}</option>
				 {% endfor %}
			</select>
		</div>
	</div>
	
	<div class="form-group">
		<label for="submit_comment" class="col-sm-4 control-label">Comment :</label>
		<div class="col-sm-8">
			<textarea id="submit_comment"></textarea>
		</div>
	</div>
	
	<div class="form-group">
		<label for="submit_comment" class="col-sm-4 control-label">Progress :</label>
		<div class="col-sm-8">
			<input type="text" name="progress" id="submit_progress">
		</div>
	</div>
	
	<div class="form-group" id="editSubmit">
		<label for="submit_comment" class="col-sm-4 control-label"></label>
		<div class="col-sm-8">
			<input id="btnsavesubmit" type="button" class="btn btn-info btn-small" value="Save">
			<input id="btncancelsubmit" type="button" class="btn btn-warning btn-small" value="Cancel">
		</div>
	</div>
</div>
</form>
<!-- end submit block -->
<div class="page-container">
	<div class="assignment-edit-section">
		<div class="block-cell block-wide">
			<div class="section-title">
				<h4><i class="fa fa-file-o"></i> {{ student_name }} - {{ assignment.name }} - {{ assignment.goaloftask }}</h4>
			</div>
			<div class="controls">
				<a href="{% url 'tsweb:tsubmissionlist' %}" class="btn btn-warning btn-small pull-right" id="exitBtn" style="margin-left: 10px;">Exit</a>
				<input type="submit" id="saveAssignment" class="btn btn-info btn-small pull-right" value="Return Assignment" style="margin-left: 10px;"/>
                <input type="button" class="button btn btn-default btn-small editor-btn" value="Save" id="btnStpSave">
				<div class="searchlist pull-right">
					<div class="form-group">
						<!--<label for="lstClassid" class="col-sm-4 control-label">Revision Filter:&nbsp;</label>-->
						<select id="ele_submissionversionversion" class="form-control input-small">
							<option value="">Please Select</option>
							 {% for row in submissionreviewerlist %}
							<option value="{{ row.id }}">Revision {{ row.submissionversionid.version }}</option>
							 {% endfor %}
						</select>
					</div>
				</div>
			</div>
			<br/><br/>
			<div id="ele_submissionversionessay" name="submissionversionessay" style="width: 100%; height: auto;">
			</div>
			<!--<div id="redactor_editor" name="content" style="width: 100%; height: auto;"></div>-->
			<!--ADD TAGGING BUTTON OR HIGHLIGHT STATE-->
		</div>
	</div>
	
	<div class="panel-group side-panel panel-revision" id="side-panel" style="height: 90%; overflow: scroll;">
		<div class="panel-default block-cell block-thin block-expanded">
			<div class="panel-heading block-header">
				<h3 class="panel-title">
				<a href="#collapseFour" data-toggle="collapse"> Rubric </a>
				</h3>
				<input type="hidden" class="rubriclinkId" />
			</div>
			<div id="collapseFour" class="panel-collapse collapse in">
				<div class="block-body" style="height: 280px;">
					<!--<div>{# rubric #}</div>-->
					<div class="rubric-categories-sm" id="rubric-categories-sm">
						<div class="rubric-impact circle circle-blue">
							<p>
								Impact
							</p>
							<div class="weight-percent circle-val categoryWeightPercent" id="impact_percent" data-id="1">
								{# val #} %
							</div>
						</div>
						<div class="rubric-quality circle circle-green" data-toggle="modal" data-target="#">
							<p>
								Quality
							</p>
							<div class="weight-percent circle-val categoryWeightPercent" id="quality_percent" data-id="2">
								{# val #} %
							</div>
						</div>
						<div class="rubric-objective circle circle-grey">
							<div>
								Objective
							</div>
						</div>
						<div class="rubric-content circle circle-purple">
							<p>
								Content
							</p>
							<div class="weight-percent circle-val categoryWeightPercent" id="content_percent" data-id="3">
								{# val #} %
							</div>
						</div>
						<div class="rubric-process circle circle-red">
							<p>
								Process
							</p>
							<div class="weight-percent circle-val categoryWeightPercent" id="process_percent" data-id="4">
								{# val #} %
							</div>
						</div>
					</div>
					<button id="show_rubric_btn" class="btn btn-small btn-default hide pull-right" style="margin-bottom: -30px; font-size: .8em;">Show Rubric</button>
					<div class="impact-list hide">
						<legend>Impact Criteria</legend>
						<ul class="list-unstyled impact-list-item">
							<li>{{ criteria.name }}</li>
							<li>{{ criteria.tag }}</li>
							<li>{{ criteria.weight }}</li>
							<li>
								<div class="form-group">
									<input type="text" class="form-control input-small impact_criteria actualWeight" data-id="1" value="{{ Impact }}" placeholder="Grade 1-10"/>
									<input type="hidden" class="totalScore" data-id="1" />
								</div>
								<div class="categoryRubricScale" data-id="1"></div>
							</li>
						</ul>
						<hr/>
					</div>
					<div class="quality-list hide">
						<legend>Quality Criteria</legend>
						<ul class="list-unstyled quality-list-item">
							<li>{{ criteria.name }}</li>
							<li>{{ criteria.tag }}</li>
							<li>{{ criteria.weight }}</li>
							<li>
								<div class="form-group">
									<input type="text" class="form-control input-small quality_criteria actualWeight" data-id="2" value="{{ Content }}" placeholder="1-100"/>
									<input type="hidden" class="totalScore" data-id="2" />
								</div>
								<div class="categoryRubricScale" data-id="2"></div>
							</li>
						</ul>
						<hr/>
					</div>
					<div class="content-list hide">
						<legend>Content Criteria</legend>
						<ul class="list-unstyled content-list-item">
							<li>{{ criteria.name }}</li>
							<li>{{ criteria.tag }}</li>
							<li>{{ criteria.weight }}</li>
							<li>
								<div class="form-group">
									<input type="text" class="form-control input-small content_criteria actualWeight"  data-id="3" value="{{ Quality }}" placeholder="1-100"/>
									<input type="hidden" class="totalScore" data-id="3" />
								</div>
								<div class="categoryRubricScale" data-id="3"></div>
							</li>
						</ul>
						<hr/>
					</div>
					<div class="process-list hide">
						<legend>Process Criteria</legend>
						<ul class="list-unstyled process-list-item">
							<li>{{ criteria.name }}</li>
							<li>{{ criteria.tag }}</li>
							<li>{{ criteria.weight }}</li>
							<li>
								<div class="form-group">
									<input type="text" class="form-control input-small process_criteria actualWeight" data-id="4" value="{{ Process }}" placeholder="1-100"/>
									<input type="hidden" class="totalScore" data-id="4" />
								</div>
								<div class="categoryRubricScale" data-id="4"></div>
							</li>
						</ul>
						<hr/>
					</div>
					<div class="objective-list hide">
						<legend>Objective</legend>
						<ul class="list-unstyled objective-list-item">
							<li>
							<h5>{{ assignment.name }}</h5>
							<p>
								<b>Goal of task:</b> {{ assignment.goaloftask }}
							</p>
							<p class="text-scroll">
								<b>Description:</b> {{ assignment.description }}
							</p>
							<p>
								<b>Audience:</b> {{ assignment.audience }}
							</p>
							<p>
								<b>Length:</b> {{ assignment.minwords }} - {{ assignment.maxwords }}
							</p>
							<p>
								<b>Revisions:</b> {{ assignment.revisions }}
							</p>
							<!--
							<p>
								<b>Max Points:</b> out of 100
							</p>
							-->
							<!--
							<p>
								<b>Category:</b> {# assignment_category #}
							</p>
							-->
							<p>
								<b>Grading Criteria:</b> {{ assignment.rubricid.name }}
							</p>
							<p>
								<b>Due Date:</b> {{ assignment.duedate }}
							</p>
							</li>
						</ul>
						<hr/>
					</div>
				</div>
			</div>
		</div>
		<div class="panel-default block-cell block-thin">
			<div class="panel-heading block-header">
				<h3 class="panel-title">
				<a href="#collapseTwo" data-toggle="collapse">
				Tagging </a>
				</h3>
			</div>
			<div id="collapseTwo" class="panel-collapse collapse in">
				<div class="block-body" style="height: 100px;">
					<ul class="block-list" id="Ul1">
						<li class="tag">
						<a href="#" id="tag-details" rel="popover" data-placement="left" data-container="body" data-toggle="popover" title data-trigger="hover" data-content="{# tag-details #} this is some more info about this tag. Of course it will be loaded dynamically.." role="button">{# tag-name #} </a>
						</li>
					</ul>
				</div>
			</div>
		</div>
		<div class="panel-default block-cell block-thin" >
			<div class="panel-heading block-header">
				<h3 class="panel-title">
				<a href="#collapseThree" data-toggle="collapse"> Comments </a>
				</h3>
			</div>
			<div id="collapseThree" class="panel-collapse collapse in">
				<div class="block-body">
					<div id="commentSection">
						<form action="" role="form" class="form">
							<div class="comment-header">
							</div>
							<div class="comment-body">
								<textarea id="comment"></textarea>
							</div>
							<div class="comment-footer">
								<a id="sent-comment" type="submit" name="sent-comment" value="Send" class="pull-right">Send</a>
							</div>
							<hr />
							<ul id="comment-list" class="comment-list">
                                {% for row in textcommentlist %}
                                    <li id="{{ row.id }}"
                                        {% if row.entityid.id == 5 %}
                                        >
	                                        <i class="fa fa-file" data-toggle="tooltip" data-trigger="hover" data-placement="left" rel="tooltip" title data-original-title="Document based" data-container="body"></i>&nbsp;
                                        {% else %}
                                        onclick="getCommentPos('{{ row.id }}');" style="cursor:pointer;">
                                            <i class="fa fa-compass" data-toggle="tooltip" data-trigger="hover" data-placement="left" rel="tooltip" title data-original-title="Location based" data-container="body"></i>&nbsp;
                                        {% endif %}
                                        <i>{{ row.getCreatorFirstname }} - </i>
								        <span class="commentvalue">{{ row.comment }}</span> <br /> <time class="commentDate">{{ row.getFormatCreateDT }}</time>
                                        {% if row.entityid.id == 5 %}
                                           <a type="submit" onclick="editComment('{{ row.id }}');" style="cursor:pointer;">Edit</a>&nbsp;<a type="submit" onclick="delComment('{{ row.id }}');" style="cursor:pointer;">Delete</a>
                                        {% endif %}
                                    </li>
							    {% endfor %}
							</ul>
						</form>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!--End Side Panel-->
</div>
<!-- end page container -->

<div class="lesson" id="autoLesson" style="display: none;">
	
		<div class="lesson-body">
			<div class="lesson-section">
				<div class="lesson-section-header lesson-header-small">{# activity_name #}
					<button type="button" class="close" aria-hidden="true">&times;</button>
				</div>
				<a href="#" class="btn btn-small btn-default" style="position: absolute; top: 5px; left: 4px;">Back to unit</a>
				<div class="lesson-section-body">
					<form class="form form-inline" role="form">
						<div class="section-one">
							<div class="form-group">
								<select class="form-control input-small">
									<option>Choose Unit</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control input-small">
									<option>Lesson</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control input-small">
									<option>Activity</option>
								</select>
							</div>
						
							<hr />
							<div class="form-group">
								<div class="btn-group">
									<button class="btn btn-default" role="button" id="stageBtn1">Stage 1</button>
									<button class="btn btn-default" role="button" id="stageBtn2">Stage 2</button>
									<button class="btn btn-default" role="button" id="stageBtn3">Stage 3</button>
								</div>
							</div>
							
							<div class="form-group">
								<button class="btn btn-info" disabled="disabled" role="button">Chronology: {# #}</button>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<button class="btn btn-default" role="button" disabled="disabled">Type:</button>
									<button class="btn btn-warning active" role="button">Auto</button>
									<button class="btn btn-warning" role="button" id="manual_switch">Manual</button>
								</div>
							</div>
							
							<div class="form-group">
								<button class="btn btn-default" role="button"><i class="fa fa-angle-left"></i> Back</button>
								<button class="btn btn-default" role="button">Next <i class="fa fa-angle-right"></i></button>
								<button class="btn btn-primary" type="submit" role="button" id="saveActivityBtn">Save</button>
							</div>
						</div><!-- /.section-one -->
						
						<div class="section-two">
							<ul class="nav nav-tabs nav-justified">
							  <li class="active"><a href="#content_section" data-toggle="tab">Content</a></li>
							  <li><a href="#question_section" data-toggle="tab">Question</a></li>
							  <li><a href="#answer_section" data-toggle="tab">Answer</a></li>
							  <li><a href="#result_section" data-toggle="tab">Result</a></li>
							</ul>
							<br />
							
							<div class="tab-content">
								<!--CONTENT SECTION-->
								<div id="content_section" class="tab-pane active">
									<div class="form-group">
										<label for="content_type_auto">Type</label>
										<select class="form-control input-small" id="content_type_auto">
											<option value="text">Text</option>
											<option value="video">Video</option>
											<option value="url">URL</option>
											<option value="file">File</option>
											<option value="image">Image</option>
											<option value="ppt">PowerPoint</option>
										</select>
									</div>
									<div class="form-group">
										<label for="content_type_input">Content</label>
										<input type="text" name="content_type_input" class="form-control input-small" id="content_type_input" placeholder="Input Type Here"/>
									</div>
									
									<div class="form-group">
										<label for="content_type_upload">Content Upload</label>
										<input type="file" name="content_type_upload" class="form-control input-small upload btn btn-warning" id="content_type_upload"/>
									</div>

									<div class="form-group">
										<label for="content_tooltip">Tooltip</label>
										<input type="text" name="content_tooltip" id="content_tooltip" class="form-control input-small" placeholder="Tooltip" data-toggle="tooltip" data-rel='tooltip' data-placement="top" rel="tooltip" title data-original-title="This is a tooltip."/>
									</div>
								</div>		
								
								
								<!--QUESTION SECTION-->
								<div id="question_section" class="tab-pane">
									<div class="form-group">
										<label for="question_type_auto">Type</label>
										<select class="form-control input-small" id="question_type_auto">
											<option value="select">Select</option>
											<option value="multiple_choice">Multiple Choice</option>
											<option value="check_box">Checkbox</option>
											<option value="option">Option</option>
										</select>
									</div>
									
									<div class="form-group">
										<label for="question_type_input">Question</label>
										<textarea type="text" name="question_type_input" class="form-control input-small" id="question_type_input" placeholder="Input Question Here" style="height: 125px;"></textarea>
									</div>
									
									<div class="form-group">
										<label for="question_tooltip">Tooltip</label>
										<input type="text" name="question_tooltip" id="question_tooltip" class="form-control input-small" placeholder="Tooltip" data-toggle="tooltip"  data-rel='tooltip' data-placement="top" rel="tooltip" title data-original-title="This is a tooltip."/>
									</div>
									
								</div>
								
								<!--ANSWER SECTION-->
								<div id="answer_section" class="tab-pane">
									<div class="form-group">
										<label for="answer_input_auto">Answer(s)</label>
									</div>
									
									<div class="input-group">
							      <span class="input-group-addon input-small">
							        <input type="checkbox">
							      </span>
							      <input type="text" class="form-control input-small" placeholder="Input Answer Here">
							    </div><!-- /input-group -->
							    <div class="input-group">
							      <span class="input-group-addon input-small">
							        <input type="checkbox">
							      </span>
							      <input type="text" class="form-control input-small" placeholder="Input Answer Here">
							    </div><!-- /input-group -->
							    <div class="input-group">
							      <span class="input-group-addon input-small">
							        <input type="checkbox">
							      </span>
							      <input type="text" class="form-control input-small" placeholder="Input Answer Here">
							    </div><!-- /input-group -->
							    <div class="input-group">
							      <span class="input-group-addon input-small">
							        <input type="checkbox">
							      </span>
							      <input type="text" class="form-control input-small" placeholder="Input Answer Here">
							    </div><!-- /input-group -->
							    <div class="input-group">
							      <span class="input-group-addon input-small">
							        <input type="checkbox">
							      </span>
							      <input type="text" class="form-control input-small" placeholder="Input Answer Here">
							    </div><!-- /input-group -->
							    <div class="input-group">
							      <span class="input-group-addon input-small">
							        <input type="checkbox">
							      </span>
							      <input type="text" class="form-control input-small" placeholder="Input Answer Here">
							    </div><!-- /input-group -->
							    
							    									
									<div class="form-group">
										<label for="answer_tooltip">Tooltip</label>
										<input type="text" name="answer_tooltip" id="answer_tooltip" class="form-control input-small" placeholder="Tooltip" data-toggle="tooltip"  data-rel='tooltip' data-placement="top" rel="tooltip" title data-original-title="This is a tooltip."/>
									</div>
									
								</div>
								
								<!--RESULT SECTION-->
								<div id="result_section" class="tab-pane">
									<div class="form-group">
										<label for="result_input_auto">Result</label>
									</div>
									
									<div class="input-group">
									  <span class="input-group-addon input-small">
									    <input type="checkbox">
									  </span>
									  <input type="text" class="form-control input-small" value="{# answer #}">
									</div><!-- /input-group -->
									<div class="input-group">
									  <span class="input-group-addon input-small">
									    <input type="checkbox">
									  </span>
									  <input type="text" class="form-control input-small" value="{# answer #}">
									</div><!-- /input-group -->
									<div class="input-group">
									  <span class="input-group-addon input-small">
									    <input type="checkbox">
									  </span>
									  <input type="text" class="form-control input-small" value="{# answer #}">
									</div><!-- /input-group -->
									<div class="input-group">
									  <span class="input-group-addon input-small">
									    <input type="checkbox">
									  </span>
									  <input type="text" class="form-control input-small" value="{# answer #}">
									</div><!-- /input-group -->
									<div class="input-group">
									  <span class="input-group-addon input-small">
									    <input type="checkbox">
									  </span>
									  <input type="text" class="form-control input-small" value="{# answer #}">
									</div><!-- /input-group -->
									<div class="input-group">
									  <span class="input-group-addon input-small">
									    <input type="checkbox">
									  </span>
									  <input type="text" class="form-control input-small" value="{# answer #}">
									</div><!-- /input-group -->
	
									
									<div class="form-group">
										<label for="result_tooltip">Tooltip</label>
										<input type="text" name="result_tooltip" id="result_tooltip" class="form-control input-small" placeholder="Tooltip" data-toggle="tooltip"  data-rel='tooltip' data-placement="top" rel="tooltip" title data-original-title="This is a tooltip."/>
									</div>
									
								</div>
													
							</div> <!-- tab-content -->
							
						</div><!-- /.section-two -->
						
						<div class="section-three text-center">
							<div class="preview_section">
								<img src="{% static 'tsweb/image/test_img.png' %}" alt="preview image" style="width: 100%;" />
							</div>
							
							<!--<button class="btn btn-info" role="button">Record Answer</button>-->
						</div>
						
					</form>
				</div>
			</div>
		</div>
		
	</div> <!-- /. ACTIVITY AUTO -->
	
	
	<!--ACTIVITY MANUAL-->
	<div class="lesson" id="manualLesson" style="display: none;">
	
		<div class="lesson-body">
			<div class="lesson-section">
				<div class="lesson-section-header lesson-header-small">{# activty_name #}
					<button type="button" class="close" aria-hidden="true">&times;</button>
				</div>
				<a href="#" class="btn btn-small btn-default" style="position: absolute; top: 5px; left: 4px;">Back to unit</a>
				<div class="lesson-section-body">
					<form class="form form-inline" role="form" id="manual_lesson">
						<div class="section-one">
							<div class="form-group">
								<select class="form-control input-small">
									<option>Choose Unit</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control input-small">
									<option>Lesson</option>
								</select>
							</div>
							<div class="form-group">
								<select class="form-control input-small">
									<option>Activity</option>
								</select>
							</div>
						
							<hr />
							<div class="form-group">
								<div class="btn-group">
									<button class="btn btn-default" role="button" id="stageBtn1">Stage 1</button>
									<button class="btn btn-default" role="button" id="stageBtn2">Stage 2</button>
									<button class="btn btn-default" role="button" id="stageBtn3">Stage 3</button>
								</div>
							</div>
							
							<div class="form-group">
								<button class="btn btn-info" disabled="disabled" role="button">Chronology: {# #}</button>
							</div>
							<div class="form-group">
								<div class="btn-group">
									<button class="btn btn-default" role="button" disabled="disabled">Type:</button>
									<button class="btn btn-warning" role="button" id="auto_switch">Auto</button>
									<button class="btn btn-warning active" role="button">Manual</button>
								</div>
							</div>
							
							<div class="form-group">
								<button class="btn btn-default" role="button"><i class="fa fa-angle-left"></i> Back</button>
								<button class="btn btn-default" role="button">Next <i class="fa fa-angle-right"></i></button>
								<button class="btn btn-primary" type="submit" role="button" id="saveActivityBtn">Save</button>
							</div>
						</div><!-- /.section-one -->
						
						<div class="section-two">
							<ul class="nav nav-tabs nav-justified">
							  <li class="active"><a href="#content_section_manual" data-toggle="tab">Content</a></li>
							  <li><a href="#question_section_manual" data-toggle="tab">Question</a></li>
							  <li><a href="#revision_section_manual" data-toggle="tab">Revisions</a></li>
							  <li><a href="#grading_section_manual" data-toggle="tab">Grading</a></li>
							</ul>
							<br />
							
							<div class="tab-content">
								<!--CONTENT SECTION-->
								<div id="content_section_manual" class="tab-pane active">
									
									<p class="text-muted text-center">Please type your input in the text editor above</p>
		
									<div class="form-group">
										<label for="content_tooltip_manual">Tooltip</label>
										<input type="text" name="content_tooltip_manual" id="content_tooltip_manual" class="form-control input-small" placeholder="Tooltip" data-toggle="tooltip"  data-rel='tooltip' data-placement="top" rel="tooltip" title data-original-title="This is a tooltip."/>
									</div>
								</div>
								
								<!--QUESTION SECTION-->
								<div id="question_section_manual" class="tab-pane">
									<div class="form-group">
										<label for="question_type_manual">Type</label>
										<select class="form-control input-small" id="question_type_manual">
											<option value="free_text">Free Text</option>
											<option value="tagging">Tagging</option>
											<option value="comments">Comments</option>
											<option value="rubric">Rubric</option>
										</select>
									</div>
									
									<div class="form-group">
										<label for="question_type_input_manual">Question</label>
										<textarea type="text" name="question_type_input_manual" class="form-control input-small" id="question_type_input_manual" placeholder="Input Question Here" style="height: 125px;"></textarea>
									</div>
									
									<div class="form-group">
										<label for="question_tooltip_manual">Tooltip</label>
										<input type="text" name="question_tooltip_manual" id="question_tooltip_manual" class="form-control input-small" placeholder="Tooltip" data-toggle="tooltip"  data-rel='tooltip' data-placement="top" rel="tooltip" title data-original-title="This is a tooltip."/>
									</div>
								</div>
								
								<!--QUESTION SECTION-->
								<div id="revision_section_manual" class="tab-pane">
									<div class="form-group">
										<label for="number_of_revisions">Number of Revisions</label>
										<input type="number" name="number_of_revisions" id="number_of_revisions" placeholder="1-10" class="form-control input-small" />
									</div>
									
									<div class="form-group">
										<label for="revision_type">Revision Type</label>
										<select class="form-control input-small">
											<option>Revision 1</option>
											<option value="self-review">Self Review</option>
											<option value="peer-review">Peer Review</option>
											<option value="teacher-review">Teacher Review</option>
										</select>
										<br />
										<select class="form-control input-small">
											<option>Revision 2</option>
											<option value="self-review">Self Review</option>
											<option value="peer-review">Peer Review</option>
											<option value="teacher-review">Teacher Review</option>
										</select>
										<br />
										<select class="form-control input-small">
											<option>Revision 3</option>
											<option value="self-review">Self Review</option>
											<option value="peer-review">Peer Review</option>
											<option value="teacher-review">Teacher Review</option>
										</select>
										<select class="form-control input-small">
											<option>Revision 4</option>
											<option value="self-review">Self Review</option>
											<option value="peer-review">Peer Review</option>
											<option value="teacher-review">Teacher Review</option>
										</select>
										<select class="form-control input-small">
											<option>Revision 5</option>
											<option value="self-review">Self Review</option>
											<option value="peer-review">Peer Review</option>
											<option value="teacher-review">Teacher Review</option>
										</select>
									</div>
								</div>
								
								<!--QUESTION SECTION-->
								<div id="grading_section_manual" class="tab-pane">
									<div class="form-group">
										<label for="tagging_checkbox"><input type="checkbox" name="tagging_checkbox" value="" /> Tagging</label>
									</div>
									
									<div class="form-group">
										<label for="commenting_checkbox"><input type="checkbox" name="commenting_checkbox" value="" /> Commenting</label>
									</div>
									
									<div class="form-group">
										<label for="rubricing_checkbox"><input type="checkbox" name="rubricing_checkbox" value="" /> Rubricing</label>
									</div>
									
									<div class="form-group">
										<label for="objective_for_grader">Objective for grader</label>
										<textarea class="form-control" id="objective_for_grader" style="height: 125px;"></textarea>
									</div>
									
								</div>
														
							</div>
						</div><!-- /.section-two-->
						
						<div class="section-three">
							<div class="preview_section">
								<img src="{% static 'tsweb/image/test_img.png' %}" alt="preview image" style="width: 100%;" />
							</div>
						</div>
						
					</form>
				</div>
			</div>
		</div>
		
	</div> <!-- /. ACTIVITY MANUAL -->
<!-- /. lesson small -->



<div class="tag-list-dropdown" id="divedithighlight" style="width: 300px; padding-top:20px; z-index:2;">
	<button type="button" class="close" id="close_tag_list" aria-hidden="true" style="margin-top: -20px; color: white;">&times;</button>
	<!--<form class="form" role="form">-->
	
		<div class="form-group">
			<select class="form-control input-small" id="ele_highlightCategory">
				<option value="">Category - Please Select</option>
				{% for row in categoryentity %}
				<option value="{{ row.categoryid.id }}">{{ row.categoryid.name }}</option>
				{% endfor %}
			</select>
		</div>
		
		<div id="tdtag" class="form-group">
			<input type="text" class="tag form-control input-small"  id="ele_highlightTag" name="tag[]" placeholder="Tag name">
		</div>

        <div id="tdtagdisplay" class="form-group">
            <label id="ele_highlightTagDisplay"></label>
        </div>
		
		<div class="editHighlightSuggest form-group">
			<select class="form-control input-small" id="ele_suggestTags">
				<option>Suggested Tags</option>
			</select>
		</div>
		
		<div class="form-group">
			<textarea class="form-control input-small" id="ele_highlightComment" placeholder="Comments..." style="height: 80px;"></textarea>
		</div>

        <div id="viewhighlight" class="text-center">
            <button class="btn btn-info btn-small" role="button" id="btnedithighlight">Edit</button>
        </div>

		<div id="edithighlight" class="text-center">
			<button class="btn btn-danger btn-small" role="button" id="btndeletehighlight">Delete</button>
			<button class="btn btn-success btn-small" role="button" id="btnsavehighlight">Save</button>
		</div>
	<!--</form>-->
</div>

<script>

	    $('#auto_switch').click(function (event) {
	    	$('#autoLesson').css('display', 'block');
	    	$('#manualLesson').css('display', 'none');
	    	event.preventDefault();
	    });
	    $('#manual_switch').click(function (event) {
	    	$('#autoLesson').css('display', 'none');
	    	$('#manualLesson').css('display', 'block');
	    	event.preventDefault();
	    });
	    
	    $('#tag-details').click(function () {
	        openDynamicLesson();
	    });
	    $('.rubric-impact').click(function () {
	        $('#rubric-categories-sm').addClass('hide');
	        $('.impact-list').removeClass('hide');
	        $('#show_rubric_btn').removeClass('hide');
	    });
	    $('.rubric-quality').click(function () {
	        $('#rubric-categories-sm').addClass('hide');
	        $('.quality-list').removeClass('hide');
	        $('#show_rubric_btn').removeClass('hide');
	    });
	    $('.rubric-content').click(function () {
	        $('#rubric-categories-sm').addClass('hide');
	        $('.content-list').removeClass('hide');
	        $('#show_rubric_btn').removeClass('hide');
	    });
	    $('.rubric-process').click(function () {
	        $('#rubric-categories-sm').addClass('hide');
	        $('.process-list').removeClass('hide');
	        $('#show_rubric_btn').removeClass('hide');
	    });
	    $('.rubric-objective').click(function () {
	        $('#rubric-categories-sm').addClass('hide');
	        $('.objective-list').removeClass('hide');
	        $('#show_rubric_btn').removeClass('hide');
	    });
  		function openDynamicLesson() {
  			$('#lessonSmall').toggle(1000, 'easeOutExpo');
  			$('#lessonSmall').css('display', 'block').css('z-index', '99999');	
  		}
  		$('#lessonSmall .close').click(function () {
  			openDynamicLesson();
  		});
	       
      $("[rel=popover]").popover();
      $('[rel=tooltip]').tooltip();	          
	</script>
</body>
</html>