<!--{% load staticfiles %}-->
<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8"/> 
	<!--<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/Prototype.css' %}" />-->
<!--	<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/smoothness/jquery-ui-1.10.3.custom.min.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/smoothness/jquery-ui-1.10.3.custom-edited.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/bootstrap.css' %}" />
	<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/topscholars.css' %}" />-->
	
	<link rel="stylesheet" href="{% static 'tsweb/css/bootstrap.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'tsweb/css/topscholars.css' %}" type="text/css" />
	<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
	<link rel="stylesheet" type="text/css" href="{% static 'tsweb/css/smoothness/jquery-ui-1.10.3.custom.min.css' %}" />
	<link rel="stylesheet" href="{% static 'tsweb/css/redactor.css' %}" type="text/css" />
	<link rel="stylesheet" href="{% static 'tsweb/css/jquery.comment.css' %}" type="text/css" />
	<!--<link rel="stylesheet" href="../../../static/tsweb/css/redactor-iframe.css" />-->
	<!--<script src="{% static 'tsweb/js/jQuery1.10.1.js' %}"></script>-->
	<!--<script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>-->
	
	<script src="{% static 'tsweb/js/jQuery1-10-1.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>
	<script src="{% static 'tsweb/js/bootstrap.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/transition.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/jquery.cookie.js' %}"></script>
	<script src="{% static 'tsweb/js/util.js' %}"></script>
	<script src="{% static 'tsweb/js/popover.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/redactor.min.js' %}"></script>
	<script src="{% static 'tsweb/js/jquery.comment.js' %}"></script>
	<script src="{% static 'tsweb/js/jquery-touch-punch.min.js' %}" type="text/javascript"></script>
	<script src="{% static 'tsweb/js/jquery.tagedit.js' %}"></script>
	<script src="{% static 'tsweb/js/jquery.autoGrowInput.js' %}"></script>
	
	
		<!--DELETE BEFORE DEPLOYMENT-->
		<link rel="stylesheet" href="../../../static/tsweb/css/bootstrap.css" type="text/css" />
		<link rel="stylesheet" href="../../../static/tsweb/css/topscholars.css" type="text/css" />
		<link href="//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
		<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
		<link rel="stylesheet" href="../../../static/tsweb/css/redactor.css" />
		<link rel="stylesheet" href="../../../static/tsweb/css/jquery.comment.css" />
		<!--<link rel="stylesheet" href="../../../static/tsweb/css/redactor-iframe.css" />-->
		<!--<script src="{% static 'tsweb/js/jQuery1.10.1.js' %}"></script>-->
		<!--<script src="{% static 'tsweb/js/jquery-ui-1.10.3.custom.min.js' %}"></script>-->
		
		<script src="../../../static/tsweb/js/jQuery1-10-1.js" type="text/javascript"></script>
		<script src="../../../static/tsweb/js/jquery-ui-1-10-3-custom-min.js" type="text/javascript"></script>
		<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
		<script src="../../../static/tsweb/js/bootstrap.js" type="text/javascript"></script>
		<script src="../../../static/tsweb/js/transition.js" type="text/javascript"></script>
		<script src="../../../static/tsweb/js/popover.js" type="text/javascript"></script>
		<script src="../../../static/tsweb/js/redactor.min.js" type="text/javascript"></script>
		<script src="../../../static/tsweb/js/jquery.comment.js" type="text/javascript"></script>
		<script src="../../../static/tsweb/js/jquery-touch-punch.min.js" type="text/javascript"></script>
	<!--==============================================-->
	
	
	<script>
		$(document).ready(function () {
			$('#commentSection').comments({
				getCommentUrl: "/JqComment/GetComments",
				postCommentUrl: "/JqComment/PostComment",
				deleteCommentUrl: "/JqComment/DeleteComment",
			});
		})
		$(function()
		{
		    $('#redactor_content').redactor({
		        
		    });
		});
	</script>
</head>

<body>
<script>
function EDITTABLE(){
	var thisClass = this;
	var evalClass = 'SUBMISSIONCREATE';
	var essay;
	var url = "{% url 'tsweb:tprocessajax' %}";
	this.startHighlightPositon = '';
	
	this.setProgressBar = function(progress) {
		$( "#progressbar" ).progressbar({
	      value: progress
	    });
	}
	
	this.highlightEssay = function() {
		$.getJSON(
		url,
		{	'class' :  'SUBMISSIONREVIEW',
			'method' : 'getSubmissionVersionHighlightList',
			'versionid' : $('#ele_submissionversionid').val() },
		function(result1){ 
			for (var i=0;i<result1.length;i++) {
				var essayhtml = $('#redactor_content').html();
				essayhtml = essayhtml .replace(result1[i].hightlighttext, '<span id="' + result1[i].id + '" style="background: red;" class="essayhighlight" onClick="openHighlightDialog(' + result1[i].id + ');">' + result1[i].hightlighttext + '</span>');
				$('#redactor_content').html(essayhtml);
			}
		})
		.error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.countWords = function(result){
		var html = '';
		var text = result.submissionversionessay;
		var maxWord = result.assignmentmaxword;
		s = text;
		s = s.replace(/(^\s*)|(\s*$)/gi,"");
		s = s.replace(/[ ]{2,}/gi," ");
		s = s.replace(/\n /,"\n");
		
		count = s.split(' ').length;
		html += count;
		html += '/';
		html += maxWord;
		//document.getElementById("ele_assignmentmaxword").innerHTML = count+"/"+maxWord;
	}
	
	this.getData = function (submissionid, versionid) {
	    $.getJSON(
			url,
			{ 'class': evalClass,
			    'method': 'getSubmissionVersion',
			    'submissionid': submissionid,
			    'versionid': versionid
			},
			function (result) {
				var teacherstaus = false;
			    $.each(result, function (ini, val) {
			    	
			        if (ini == "submissionprogress")
			            thisClass.setProgressBar(val);
			        else if (ini == "currentversion") {
			            // if (val == 'y') {
			                // $('#btnedithighlight').show();
			                // $('#btnSubmit').show();
			            // }
			            // else {
			                // $('#btnedithighlight').hide();
			                // $('#btnSubmit').hide();
			            // }
			        }
		       		else if(ini == "submissionstudentstatus") {
			        	if(val == 1) {
			        		$("#btnSave").hide();
			        		$("#btnSubmit").hide();
			        		$("#redactor_content").show();
			        		thisClass.closeEditEssay();
			        	}else{
			        		$("#btnSave").show();
			        		$("#btnSubmit").show();
			        		$('#redactor_content').unbind("keypress");
			        	}
			        }
			        else if(ini == "submissionteacherstatus") {
			        	if(val == 1) {
							teacherstaus = true;
			        	}
			        }else if(ini == "submissionversionessay"){
			        	$("#redactor_content").html(val);
			        }
			        else if ($('#ele_' + ini).is("span") || $('#ele_' + ini).is("div"))
			            $('#ele_' + ini).html(val);
			        else
			            $('#ele_' + ini).val(val);
			    });

			    essay = $('#redactor_content').html();
			    
			    if(teacherstaus){
					thisClass.countWords(result);
				    thisClass.highlightEssay();
				    thisClass.tagHighlightList();
				    thisClass.getSubmitRubric();
			   	}
			})
			.error(function (xhr, status, error) {
			    alert('Error occur. Please contact the administrator.');
			});
	}
	
	this.getSelectionCharOffsetsWithin = function(element) {
	    var start = 0, end = 0;
	    var sel, range, priorRange;
	    if (typeof window.getSelection != "undefined") {
	        range = window.getSelection().getRangeAt(0);
	        priorRange = range.cloneRange();
	        priorRange.selectNodeContents(element);
	        priorRange.setEnd(range.startContainer, range.startOffset);
	        start = priorRange.toString().length;
	        end = start + range.toString().length;
	    } else if (typeof document.selection != "undefined" &&
	            (sel = document.selection).type != "Control") {
	        range = sel.createRange();
	        priorRange = document.body.createTextRange();
	        priorRange.moveToElementText(element);
	        priorRange.setEndPoint("EndToStart", range);
	        start = priorRange.text.length;
	        end = start + range.text.length;
	    }
	    return {
	        start: start,
	        end: end
	    };
	}
	
	this.getHighlightDataTag = function(highlightid) {
		var tagids = [];
		$.getJSON(
			url,
			{	'class' :  'SUBMISSIONREVIEW',
				'method' : 'getSubmissionVersionHighlightTags',
				'highlightid' : highlightid },
			function(result){
				$(".tagedit-listelement-old").remove();
				var displaytxt = '';
				for (var i=0;i<result.length;i++) {
					tagids.push(result[i].id);
					thisClass.addTagEditElement(result[i].name , result[i].id);
					if (displaytxt != '')
						 displaytxt = displaytxt + ', '
					displaytxt = displaytxt + result[i].name;
				}
				thisClass.tagEditCloseEvent();
				thisClass.getSelectSuggest(tagids);
				$('#ele_highlightTagDisplay').text(displaytxt);
		})
		.error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.tagEditCloseEvent = function(){
		$(".tagedit-close").unbind('click');
		$(".tagedit-close").click(function(){
			var tagElement = $(this).prev();
			var thisInput = tagElement.attr('name');
				thisInput = thisInput.replace('tag[','');
				thisInput = thisInput.replace('-a]', '');
			var thisId = thisInput;
			var tagNewIds = [];
			$('input[name*="-a"]').each(function(index) {
				var nameInput = $(this).attr('name');
				nameInput = nameInput.replace('tag[','');
				nameInput = nameInput.replace('-a]', '');
				if(nameInput != thisId){
					tagNewIds.push(nameInput);
				}
			});
			thisClass.getSelectSuggest(tagNewIds);
		});
	}
	
	this.closeEditEssay = function(){
		$('#redactor_content').keypress(function(e){
			return false;
		});
	}
	
	this.getHighlightData = function(highlightid) {
		$('#ele_highlightid').val(highlightid);
		
		$.getJSON(
			url,
			{	'class' :  'SUBMISSIONREVIEW',
				'method' : 'getSubmissionVersionHighlight',
				'highlightid' : highlightid },
			function(result){
				$.each(result, function(ini,val){
					if($('#ele_' + ini).is("span") || $('#ele_' + ini).is("div"))
						$('#ele_' + ini).html(val);
					else 
						$('#ele_' + ini).val(val);
				});
				
				thisClass.getHighlightDataTag(highlightid);
				thisClass.showHighlightDialog(true);
		})
		.error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.showHighlightDialog = function(show) {
		if(show) {
			$('#diveditbg').show();
			$('#divedithighlight').show();
			$('.editHighlightSuggest').hide();
			if($('#ele_highlightid').val() != '')
			{
				thisClass.editHighlightDialog(false);
				$('#btndeletehighlight').show();
			}
			else
			{
				thisClass.editHighlightDialog(true);
				$('#btndeletehighlight').hide();
			}
		}
		else {
			$('#diveditbg').hide();
			$('#divedithighlight').hide();
			$('#ele_highlightid').val('');
			$('#ele_highlighttext').val('');
			$('#ele_highlightTagDisplay').text('');
			$('.tagedit-listelement-old').remove();
			$('#ele_highlightComment').val('');
		}
	}
	
	this.editHighlightDialog = function(edit) {
		if(edit) {
			$('#edithighlight').show();
			$('#viewhighlight').hide();
			$('#tdtagdisplay').hide();
			$('#tdtag').show();
			$('#ele_highlightTag').removeAttr("disabled"); 
			$('#ele_highlightComment').removeAttr("disabled"); 
			$('.tagedit-list').removeAttr("disabled"); 
		}
		else {
			$('#edithighlight').hide();
			$('#viewhighlight').show();
			$('#tdtagdisplay').show();
			$('#tdtag').hide();
			$('#ele_highlightTag').attr("disabled", "disabled");
			$('#ele_highlightComment').attr("disabled", "disabled");
		}
	}

	this.tagHighlightList = function () {
	    $.getJSON(
			url,
			{ 'class': evalClass,
			    'method': 'tagHighlightList',
			    'submissionversionid': $('#ele_submissionversionid').val()
			},
			function (result) {
				$("#tagList li").remove();
			    $("#tagBox").html('');
			    $("#commentArea").val('');
			    $("<ul>").attr("id", "tagList").appendTo("#tagBox");
			    if (result.length > 0) {
			    	
			        $.each(result, function (i, val) {
			            var li = $("<li>");

			            //create link
			            $("<a>").text(val[1]+"("+val[3]+")").attr({ "data-id": val[0], href: "#", class: "tagClickHighlightList" }).appendTo(li);

			            //set tag size
			            if (val[2] == 0) {
			                li.children().css({ 'font-size': '1.5em', 'font-weight': 'bold' });
			            } else {
			                li.children().css({ 'font-size': '1.2em' });
			            }

			            //add to list
			            li.appendTo("#tagList");
			        });
			    } else {
			        $("#tagList").height('50');
			    }

			    $(".tagClickHighlightList").click(function () {
			        var id = $(this).data("id");
			        thisClass.tagClickHighlightList(id);
			        return false;
			    });
			}).error(function (xhr, status, error) {
			    alert('Error occur. Please contact the administrator.');
			});
	}
	
	this.tagClickHighlightList = function(id){
		var highlightid;
		var textComment = '';
		$.getJSON(
			url,
			{	'class' :  evalClass,
				'method' : 'tagClickHighlightList',
				'taglinkid' : id,
				'submissionversionid' : $('#ele_submissionversionid').val() },
			function(result){
			$(".essayhighlight").css({'background':'red'});
			$.each(result, function(i, val) {
				highlightid = val[0];
				$("#"+highlightid+".essayhighlight").css({'background':val[2]});
				textComment += "- " + val[1] + "\n";
			});
			$("#commentArea").val(textComment);
		}).error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.del = function(){
		var highlightid = $('#ele_highlightid').val();
		
		$.post(url,
			{	'class' :  'SUBMISSIONREVIEW',
				'method' : 'delete',
				'highlightid' : highlightid },
			function(result){
				thisClass.showHighlightDialog(false);
				thisClass.getData($('#ele_submissionid').val(), $('#ele_submissionversionid').val());
			})
		.error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.showSubmitDialog = function(show) {
		if(show) {
			$('#diveditbg').show();
			$('#submitpopup').show();
		}
		else {
			$('#diveditbg').hide();
			$('#submitpopup').hide();
		}
	}
	
	this.submit = function() {
		var criteriaid =[]; 
		var criteriaval = [];
		var value,odata;
		var submissionversionid = $('#ele_submissionversionid').val();
		thisClass.showSubmitDialog(true);
		
		$(".submit_criteria").each(function(){
			id = $(this).attr('id');
			value = $(this).val();
			
			criteriaid.push(id);
			criteriaval.push(value);
		});
		odata = {'class' :  'SUBMISSIONREVIEW',
 			 'method' : 'submit',
 			 'submissionversionid' : submissionversionid,
 			 'stage' : $("#submit_stage").val(),
 			 'comment' : $("#submit_comment").val(),
 			 'progress' : $("#submit_progress").val(),
 			 'criteriaid': criteriaid,
 			 'criteriaval': criteriaval
 			 };

		$.post(url,odata,
			function(result){
				thisClass.showSubmitDialog();
				window.location = "{% url 'tsweb:tsubmissionlist' %}";
			})
		.error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.getSelectStage = function(){
		var option = '';
		$.getJSON(
			url,
			{	'class' :  evalClass,
				'method' : 'getSelectStage'
			},
			function(result){
				$.each(result, function(ini,val){
					option += '<option value="'+val.selectionvalue+'">'+val.selectionname+'</option>';
				});
				$("#submit_stage").append(option);
		}).error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.getSelectSuggest = function(tagids){
		var option = '';
		if(tagids != ""){
			$.post(
				url,
				{	'class' :  evalClass,
					'method' : 'getSelectSuggest',
					tagids : tagids
				},
				function(result){
					$("#ele_suggestTags option").remove();
					$.each(result, function(ini,val){
						option += '<option value="'+val.id+'">'+val.label+'</option>';
					});
					$("#ele_suggestTags").append(option);
					
					$("#ele_suggestTags").unbind('dblclick');
					$("#ele_suggestTags").dblclick(function(){
						var id = $(this).val();
						var name = $("#ele_suggestTags option:selected").text();
						$("#ele_suggestTags option[value='"+id+"']").remove();
						thisClass.addTagEditElement(name, id);
						
						var tagNewIds = [];

						$('input[name*="-a"]').each(function(index) {
							var nameInput = $(this).attr('name');
							nameInput = nameInput.replace('tag[','');
							nameInput = nameInput.replace('-a]', '');
							tagNewIds.push(nameInput);
						});
						thisClass.tagEditCloseEvent();
						thisClass.getSelectSuggest(tagNewIds);
					});
			}).error(function(xhr, status, error) {
	    		alert('Error occur. Please contact the administrator.');
	    	});
	    }else{
	    	$("#ele_suggestTags option").remove();
	    	$(".editHighlightSuggest").hide();
	    }
	}
	
	this.getAssignmentStatus = function(){
		$.getJSON(
			url,
			{	'class' :  evalClass,
				'method' : 'getAssignmentStatus',
				'submissionid' : $("#ele_submissionid").val()
			},
			function(result){
				$.each(result, function(ini,val){
					if(val.studentstatus !== 1 || val.teacherstatus !== 1){
						$("#btnRevise").hide();
						return false;
					}else if(val.submissionid__progress == 100){
						$("#btnRevise").hide();
						return false;
					}
				});

		}).error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.addTagEditElement = function(name, id){
		var tagitem = '<li class="tagedit-listelement tagedit-listelement-old"><span dir="ltr">' + name + '</span><input type="hidden" name="tag[' + id + '-a]" value="' + name + '"><a class="tagedit-close" title="Remove from list.">x</a></li>'
		$(tagitem).insertBefore('.tagedit-listelement-new');
	}

	this.getSubmitRubric = function(){
		var html = '';
		$.getJSON(
			url,
			{	'class' :  evalClass,
				'method' : 'getSubmitRubric',
				'submissionid' : $("#ele_submissionid").val()
			},
			function(result){
			$(".submitRubricTr").remove();
			$.each(result,function(ini, val){
				html += '<tr class="submitRubricTr"><td>'+val.criteria+' :</td><td>';
				html += '<select class="submit_criteria" id="'+val.id+'" name="'+val.criteria+'">';
				html += '</select>';
				html += '</td></tr>';
				thisClass.getSelectRubricCriteria(val.id, val.rubricid); 
			});
			$(html).insertBefore("#editSubmit");
		}).error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.getSelectRubricCriteria = function(id,rubricid){
		var html = '';
		$.getJSON(
			url,
			{	'class' :  evalClass,
				'method' : 'getSelectRubricCriteria',
				'rubricid' : rubricid
			},
			function(result){
			$.each(result,function(ini, val){
				html += '<option value="'+val.id+'">'+val.scale+'</option>';
			});
			$('#'+id+'.submit_criteria').append(html);
		}).error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
	
	this.addRevise = function(){
		var option = '';
		var maxVersion = '';
		$.getJSON(
			url,
			{	'class' :  evalClass,
				'method' : 'addRevise',
				'submissionid' : $("#ele_submissionid").val()
			},
			function(result){
				$("#ele_submissionversionversion option").remove();
	            $.each(result, function(ini, val){
	                option += '<option value="' + val.version + '">Revision ' + val.version + '</option>';
	                maxVersion = val.version;
	            });
                $("#ele_submissionversionversion").append(option);
                
                $('#ele_submissionversionversion').val(maxVersion);
                thisClass.getData($('#ele_submissionid').val(),$('#ele_submissionversionversion').val());
                
                thisClass.getAssignmentStatus();
		}).error(function(xhr, status, error) {
    		alert('Error occur. Please contact the administrator.');
    	});
	}
			
	this.initContent = function(){
		thisClass.getData($('#ele_submissionid').val(),'');
		
		thisClass.showHighlightDialog(false);
		
		thisClass.getSelectStage();

		thisClass.getAssignmentStatus();
		// $('#redactor_content').mouseup(function() {
			// var node = this;
			// if(thisClass.getSelectionCharOffsetsWithin(node).start != thisClass.getSelectionCharOffsetsWithin(node).end)
			// {
				// var start = thisClass.getSelectionCharOffsetsWithin(node).start;
				// var end = thisClass.getSelectionCharOffsetsWithin(node).end;
				// var htxt = essay;
				// htxt = htxt.substring(start,end);
				// //alert(htxt);
				// thisClass.startHighlightPositon = start;
				// $('#ele_highlighttext').val(htxt);
				// thisClass.showHighlightDialog(true);
			// }
		// });
		
		$('#btnedithighlight').click(function() {
			thisClass.editHighlightDialog(true);
			$('.editHighlightSuggest').show();
		});
		
		$('#btncloseedithighlight').click(function() {
			thisClass.showHighlightDialog(false);
		});
		
		$('#btnsavehighlight').click(function() {
			thisClass.save();
			thisClass.editHighlightDialog(false);
		});
		
		$('#btndeletehighlight').click(function() {
			thisClass.del();
		});
		
		$('#btncancelhighlight').click(function() {
			if($('#ele_highlightid').val() != '')
			{
				var highlightid = $('#ele_highlightid').val();
				thisClass.getHighlightData(highlightid);
				thisClass.editHighlightDialog(false);
			}
			else
				thisClass.showHighlightDialog(false);
		});

		$('#btnReturn').click(function() {
			window.location = "{% url 'tsweb:sindex' %}";
		});
		
		$('#btnSubmit').click(function() {
			//thisClass.showSubmitDialog(true);
			var essay = $("#redactor_content").html();
			var submissionid = $("#ele_submissionid").val();
			var submissionversionid = $('#ele_submissionversionid').val();
			odata = {'class' :  evalClass,
 			 'method' : 'submit',
 			 'submissionid' : submissionid,
 			 'submissionversionid' : submissionversionid,
 			 'essay' : essay
 			 };

			$.post(url,odata,
				function(result){
					if(result.submissionversionid !==""){
						$('#ele_submissionversionid').val(result.submissionversionid);
					}
					window.location = "{% url 'tsweb:sindex' %}";
				})
			.error(function(xhr, status, error) {
	    		alert('Error occur. Please contact the administrator.');
	    	});
		});
		
		$("#btnRevise").click(function(){
			thisClass.addRevise();
		});
		
		$('#btnSave').click(function() {
			//thisClass.showSubmitDialog(true);
			var essay = $("#redactor_content").html();
			var submissionid = $("#ele_submissionid").val();
			var submissionversionid = $('#ele_submissionversionid').val();
			odata = {'class' :  evalClass,
 			 'method' : 'save',
 			 'submissionid' : submissionid,
 			 'submissionversionid' : submissionversionid,
 			 'essay' : essay
 			 };

			$.post(url,odata,
				function(result){
					if(result.submissionversionid !==""){
						$('#ele_submissionversionid').val(result.submissionversionid);
					}
					//window.location = "{% url 'tsweb:sindex' %}";
				})
			.error(function(xhr, status, error) {
	    		alert('Error occur. Please contact the administrator.');
	    	});
		});
		
		$("#btncancelsubmit").click(function(){
			thisClass.showSubmitDialog();
		});
		
		$("#btnsavesubmit").click(function(){
			thisClass.submit();
		});
		
		$('#ele_submissionversionversion').change(function() {
			thisClass.getData($('#ele_submissionid').val(),$('#ele_submissionversionversion').val());
		});	
		
	    $(document).on('click', '.ui-menu-item', function(){
	    	$('.editHighlightSuggest').show();
			var tagNewIds = [];

			$('input[name*="-a"]').each(function(index) {
				var nameInput = $(this).attr('name');
				nameInput = nameInput.replace('tag[','');
				nameInput = nameInput.replace('-a]', '');
				tagNewIds.push(nameInput);
			});
			thisClass.tagEditCloseEvent();
			thisClass.getSelectSuggest(tagNewIds);
    	});
		
		$( '#tdtag input.tag' ).tagedit({
			autocompleteURL: "{% url 'tsweb:gettags' 5 %}",
			autocompleteOptions: {minLength: 1},
			allowEdit:false
		});
	}
}

$(function() {
	var gen = new EDITTABLE();
	gen.initContent();
});

function openHighlightDialog(highlightid){
	var gen = new EDITTABLE();
	gen.getHighlightData(highlightid);
}
</script>
	<nav class="navbar" role="navigation">
		<div class="container">
			<h1 class="logo"><a href="#">Writability - Revision</a></h1>
			<!--<p class="navbar-text pull-right"><a href="#" class="navbar-link">Student Name <span class="fa fa-reorder fa-lg"></span></a></p>-->
			<ul class="nav navbar-nav pull-right student-nav" >
				<li><a href="{% url 'tsweb:sindex' %}"><i class="fa fa-dashboard fa-lg"></i></a></li>
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-road fa-lg"></i></a>
					<ul class="dropdown-menu">
						<li class="dropdown-title">Activities</li>
						<li><a href="#">{# activity-name #}</a></li>
					</ul>
					<span class="badge">2</span>
				</li>
				<li class="dropdown">
					<a href="#" class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-file-o fa-lg"></i></a>
					<ul class="dropdown-menu">
						<li class="dropdown-title">Assignments</li>
						<li><a href="#">{# assignment-name #}</a></li>
					</ul>
					<span class="badge">2</span>
				</li>
				
				<li class="dropdown">
					<a href="#" class="dropdown-toggle student-name" data-toggle="dropdown">{{ user_name }}</a>
					<ul class="dropdown-menu">
						<li><a href="{% url 'tsweb:logout' %}"><i class="fa fa-power-off"></i> Log Out</a></li>
					</ul>
				</li>
			</ul>
			
			<form class="navbar-form" role="search" id="search-form" method="" action="null">
				<div class="input-group col-lg-3 col-offset-5">
					<input type="text" class="form-control">
		      <span class="input-group-btn">
		        <input class="btn btn-default" type="submit" value="Search">
		      </span>
		    </div><!-- /input-group -->
	    </form>
	    
		</div>
		
	</nav> <!-- End Nav -->
	
	<div class="nav-border" style="display: none;"></div>
	<button id="hide-nav" type="button" class="btn btn-small pull-right"><i class="fa fa-arrow-up"></i></button>
	
	<div class="page-container">
		
		<div class="assignment-edit-section">
			 <div class="block-cell block-wide">
 					<input type="hidden" id="ele_submissionid" value="{{ id }}">
					<input type="hidden" id="ele_submissionversionid">
					
				<!-- submit block -->
				<div id="diveditbg" style="background-color:gray;z-index:1;width:100%;height:100%;position:absolute;opacity:0.4;"></div>
				<div id="submitpopup" style="z-index:2;width:500px;position:absolute;background-color:white;margin-top:10%;margin-left:35%;padding:10px;display:none;">
				<table style="width:100%;">
					<tr>
						<td>Stage :</td>
						<td><select id="submit_stage"></select></td>	
					</tr>
					<tr>
						<td>Comment :</td>
						<td>
							<textarea id="submit_comment"></textarea>
						</td>
					</tr>
					<tr>
						<td>Progress :</td>
						<td><input type="text" id="submit_progress"></td>
					</tr>
					<tr id="editSubmit">
						<td colspan="2" style="text-align:center;">
							<input id="btnsavesubmit" type="button" class="button btn-small" style="width:80px;height:26px;" value="Save">&nbsp;
							<input id="btncancelsubmit" type="button" class="button btn-small" style="width:80px;height:26px;" value="Cancel">
						</td>
					</tr>
				</table>
				</div>
				<!-- end submit block -->
				<div class="searchlist form form-horizontal">
						<div class="col-sm-4">
							<div class="form-group">
							
								<select id="ele_submissionversionversion" class="form-control input-small">
								{% for row in submissionversionlist %}
									<option value="{{ row.version }}">Revision {{ row.version }}</option>
								{% endfor %}
								</select>
							</div>
						</div>
							
						<input type="button" class="button btn btn-default btn-small editor-btn" value="Save" id="btnSave">
						<input type="button" class="button btn btn-default btn-small editor-btn" value="Revise" id="btnRevise"/>
						<input type="submit" class="btn btn-info btn-lg btn-small editor-btn" id="btnSubmit"  value="Send Teacher" />
						<a href="{% url 'tsweb:sindex' %}" class="btn btn-warning btn-small editor-btn">Exit</a>	
						
					
				</div>
				<div style="position: absolute; top: 50px; width: 100%;">
			 		<div id="redactor_content" name="content" style="width: 100%; height: auto;">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</div>
			 		<!--ADD TAGGING BUTTON OR HIGHLIGHT STATE-->
		 		</div>
			 </div>
			
		</div>
		
		<div class="tag-list-dropdown col-lg-2" style="display: none;">
			<form class="form" role="form">
		    <div class="input-group input-group-sm">
		      <input type="text" class="form-control">
		      <span class="input-group-btn">
		        <input class="btn btn-info" type="submit" value="Add Tag"/>
		      </span>
		    </div><!-- /input-group -->
				
				<ul id="taglist">
					<li><a href="#">{# tag #}</a></li>
				</ul>
				
				<!--<input type="submit" name="add-tab" value="Add Tag" class="btn btn-primary btn-small pull-right" />-->
			</form>
		</div>
		
		<button type="button" class="btn btn-small hide-panel" id="hide-panel"><i class="fa fa-arrow-right"></i></button>

		<div class="panel-group side-panel panel-revision" id="side-panel">
		
			<div class="panel-default block-cell block-thin block-expanded">
				<div class="panel-heading block-header">
					<h3 class="panel-title">
						<a href="#">
							Rubric
						</a>
					</h3>
				</div>
				<div id="collapseFour" class="panel-collapse">
					<div class="block-body">
						<!--<div>{# rubric #}</div>-->
						
						<div class="rubric-categories-sm">
							<div class="rubric-impact circle circle-blue">
								<p>Impact</p>
								<div class="weight-percent circle-val" id="impact_percent">{#val#} %</div>
							</div>
							
							<div class="rubric-quality circle circle-green">
								<p>Quality</p>
								<div class="weight-percent circle-val" id="quality_percent">{#val#} %</div>
							</div>
							
							<div class="rubric-objective circle circle-grey">
								<div>Objective</div>
							</div>
							
							<div class="rubric-content circle circle-purple">
								<p>Content</p>
								<div class="weight-percent circle-val" id="content_percent">{#val#} %</div>
							</div>
							
							<div class="rubric-process circle circle-red">
								<p>Process</p>
								<div class="weight-percent circle-val" id="process_percent">{#val#} %</div>
							</div>
						</div>
						
						<div class="progress progress-striped active lesson-progress">
						  <div class="progress-bar"  role="progressbar" aria-valuenow="50" aria-valuemin="10" aria-valuemax="100" style="width: 100%">
						    <span class="sr-only">100% Complete</span>
						  </div>
						</div>
						
					</div>
				</div>
			</div>
			
				  
		  <div class="panel-default block-cell block-thin">
		  	
		    <div class="panel-heading block-header">
		      <h3 class="panel-title">
		        <a href="#">
		          Tagging
		        </a>
		      </h3>
		    </div>
		    <div id="collapseTwo" class="panel-collapse">
		      <div class="block-body">
		        <ul class="block-list" id="tagList">
		        	<li class="tag">
			        	<a href="#" id="tag-details" rel="popover"
			        		data-placement="left"
			        		data-container="body"
			        		data-toggle="popover" title
			        		data-trigger="hover"
			        		data-content="{# tag-details #} this is some more info about this tag.  Of course it will be loaded dynamically.."
			        		role="button">{# tag-name #}
			        		<span class="fa fa-frown-o"></span>
		        		</a>
	        		</li>
		        </ul>
		      </div>
		    </div>
		  </div>
	
		  <div class="panel-default block-cell block-thin">
		    <div class="panel-heading block-header">
		      <h3 class="panel-title">
		        <a href="#">
		          Comments
		        </a>
		      </h3>
		    </div>
		    <div id="collapseThree" class="panel-collapse">
		      <div class="block-body">
		       	<div id="commentSection">
		       	
		       	</div>
		      </div>
		    </div>
		  </div>
			  
		</div> <!--End Side Panel-->

	</div> <!--End Page Container-->
		
<div id="divedithighlight" style="z-index:2;width:500px;position:absolute;background-color:white;margin-top:10%;margin-left:35%;padding:10px;">
	<input id="ele_highlightid" type="hidden">
	<input id="ele_highlighttext" type="hidden">
	<table style="width:100%;">
		<tr>
			<td>Tag:</td>
			<td id="tdtag">
				<input id="ele_highlightTag" type="text" name="tag[]" value="" class="tag" style="width:420px;"/>
			</td>
			<td id="tdtagdisplay">
				<label id="ele_highlightTagDisplay"></label>
			</td>
		</tr>
		<tr class="editHighlightSuggest">
			<td>Suggest tags:</td>
			<td>
				<select id="ele_suggestTags" size="4"></select>
			</td>
		</tr>
		<tr>
			<td style="vertical-align:top;">Comment:</td>
			<td><textarea id="ele_highlightComment" style="width:420px;height:100px;resize:none;"></textarea></td>
		</tr>
		<tr id="viewhighlight">
			<td colspan="2" style="text-align:center;">
				<!-- <input id="btnedithighlight" type="button" class="button btn btn-default" style="width:80px;" value="Edit">&nbsp; -->
				<input id="btncloseedithighlight" type="button" class="button btn btn-default" style="width:80px;" value="Close">
			</td>
		</tr>
		<tr id="edithighlight">
			<td colspan="2" style="text-align:center;">
				<input id="btnsavehighlight" type="button" class="button btn btn-default btn-small" style="width:80px;" value="Save">&nbsp;
				<input id="btndeletehighlight" type="button" class="button btn btn-default btn-small" style="width:80px;" value="Delete">&nbsp;
				<input id="btncancelhighlight" type="button" class="button btn btn-default btn-small" style="width:80px;" value="Cancel">
			</td>
		</tr>
	</table>
</div>
	
	<!--<button class="btn lesson-btn">Lessons <i class="fa fa-arrow-up"></i></button>-->
	
	<div class="lesson" id="lessonLarge" style="display: none;">

		<div class="lesson-body">
			<div class="lesson-section">
				<div class="lesson-section-header">Lesson
				<button type="button" class="close" aria-hidden="true">&times;</button>
				</div>
				
				<div class="lesson-section-body">
					<div class="lesson-media pull-left">
						<h2 class="text-center">Lesson Media</h2>
						<iframe width="320" height="240" src="//www.youtube.com/embed/utUPth77L_o" frameborder="0" allowfullscreen></iframe>
					</div>
					
					<div class="lesson-text pull-left">
						<h2 class="text-center">Lesson Text</h2>
						<p id="lessonText">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum
						</p>
					</div>
					
					<div class="lesson-quiz pull-left">
						<h2 class="text-center">Lesson Quiz</h2>
						<form class="form" role="form">
							<div class="form-group">
								<label for="question1">This is a sample question in a static lesson view...</label>
								<input type="text" name="question1" value="" id="question1" class="form-control" placeholder="Answer here" />
							</div>
							
							<input type="submit" name="quizSubmit" value="Submit" id="quizSubit" class="btn btn-success pull-right" />
						</form>
					</div>
				</div> <!-- /. lesson-section-body -->
			</div>  <!-- /. lesson-section -->
		</div> <!-- /. lesson-body -->
		
	</div> <!-- /. lesson large -->
	
	
	<div class="lesson" id="lessonSmall" style="display: none;">
	
		<div class="lesson-body">
			<div class="lesson-section">
				<div class="lesson-section-header lesson-header-small">{# lesson_name #}
					<button type="button" class="close" aria-hidden="true">&times;</button>
				</div>
				<div class="lesson-section-body">
					<form class="form form-horizontal" role="form">
						<div class="section-wide">
							<p id="ele_example">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum</p>
							
							<p id="ele_question" style="display: none;">Lorem ipsum dolor sit amet, consectetur adipisicing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam?</p>
							
							<p id="ele_answer" style="display: none;">Lorem ipsum dolor sit amet, consectetur adipisicing elit</p>
								<div class="form-group">
								<label for="answerSubmit" class="col-sm-2 control-label">Answer Here</label>
								<div class="col-sm-10">
									<input type="text" name="answerSubmit" id="answerSubmit" class="form-control" />
								</div>
							</div>
							<hr />
							<div class="text-center">
								<button class="btn btn-default" role="button" id="backBtn"><i class="fa fa-angle-left"></i> Back</button>
								<button class="btn btn-default" role="button" id="nextBtn">Next <i class="fa fa-angle-right"></i></button>
								<button class="btn btn-danger" role="button" id="resetQuestion">Reset Question</button>
								<button class="btn btn-primary" type="submit" role="button">Submit Answer</button>
							</div>

						</div>
					</form>
				</div>
			</div>
		</div>
		
	</div> <!-- /. lesson small -->
	
<!--			<!--impact criteria--*>
			  <label for="grade1">Grade:</label>
		  	<input type="text" id="grade1" style="border:0; color:#f6931f; font-weight:normal;">


			<!--content criteria--*>
			  <label for="grade2">Grade:</label>
			  <input type="text" id="grade2" style="border:0; color:#f6931f; font-weight:normal;">

			<!--quality criteria--*>
			  <label for="grade3">Grade:</label>
			  <input type="text" id="grade3" style="border:0; color:#f6931f; font-weight:normal;">


			<!--process criteria--*>
			  <label for="grade4">Grade:</label>
			  <input type="text" id="grade4" style="border:0; color:#f6931f; font-weight:normal;">
											
			<!--objective--*>
				<h5>{# assignment_name #}</h5>
				<p class="text-scroll"><b>Description:</b> {# assignment_description #}</p>
				<p><b>Max Points:</b> out of 100</p>
				<p><b>Category:</b> {# assignment_category #}</p>
				<p><b>Grading Criteria:</b> {# rubric_name #}</p>
				<p><b>Due Date:</b> {# due_date #}</p>			-->

	
	<script>
		$(document).ready(function () {
		
			$('#hide-panel').click(function () {
				$('.side-panel').toggle('slideRight','easeOutExpo',300);	
			});
			
			$('.nav-border').css('display', 'block');
			$('#hide-nav').click(function () {
				$('.navbar').toggle();
				$('.nav-border').css('display', 'block');
			});
			
			$('#hide-nav').click(function (e) {
				if ($('#hide-nav i').hasClass('fa-arrow-up')) {
					$('#hide-nav i').removeClass('fa-arrow-up').addClass('fa-arrow-down');
					$('.block-wide').css('margin-top', '10px').css('height', '100%');
					$('.side-panel').css('margin-top', '-60px');
					$('.hide-panel').css('margin-top', '-60px');
				} else {
					$('#hide-nav i').removeClass('fa-arrow-down').addClass('fa-arrow-up');
					$('.block-wide').css('margin-top', '70px').css('height', '550px');
					$('.side-panel').css('margin-top', '0px');
					$('.hide-panel').css('margin-top', '0px');
				}
			});
			
			$('.hide-panel').click(function (e) {
				if ($('.hide-panel i').hasClass('fa-arrow-right')) {
					$('.hide-panel i').removeClass('fa-arrow-right').addClass('fa-arrow-left');
					$('.block-wide').css('width', '100%');
				} else {
					$('.hide-panel i').removeClass('fa-arrow-left').addClass('fa-arrow-right');
					$('.block-wide').css('width', '75%');
				}
			});
			
			
			$('.lesson-btn').click(function arrowToggle() {
				openStaticLesson();

				if ($('.lesson-btn i').hasClass('fa-arrow-up')) {
					$('.lesson-btn i').removeClass('fa-arrow-up').addClass('fa-arrow-down');
				} else {
					$('.lesson-btn i').removeClass('fa-arrow-down').addClass('fa-arrow-up');
				}
			});
			$('#lessonLarge .close').click(function () {
				openStaticLesson();
				if ($('.lesson-btn i').hasClass('fa-arrow-up')) {
					$('.lesson-btn i').removeClass('fa-arrow-up').addClass('fa-arrow-down');
				} else {
					$('.lesson-btn i').removeClass('fa-arrow-down').addClass('fa-arrow-up');
				}
			});
			
			$('#tag-details').click(function () {
				openDynamicLesson();
			});
			$('#lessonSmall .close').click(function () {
				openDynamicLesson();
			});
			
			//Open lessons
			function openStaticLesson() {
				$('#lessonLarge').toggle(1000, 'easeOutElastic');
				$('#lessonLarge').css('display', 'block');
			}
			function openDynamicLesson() {
				$('#lessonSmall').toggle(1000, 'easeOutElastic');
				$('#lessonSmall').css('display', 'block');
			}
			
			$(function() {
			    $( "#grade-slider1" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade1" ).val( ui.value );
			      }
			    });
			    $( "#grade1" ).val( $( "#grade-slider1" ).slider( "value" ) );
			  });
			  
			$(function() {
			    $( "#grade-slider2" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade2" ).val( ui.value );
			      }
			    });
			    $( "#grade2" ).val( $( "#grade-slider2" ).slider( "value" ) );
			  });
			
			$(function() {
			    $( "#grade-slider3" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade3" ).val( ui.value );
			      }
			    });
			    $( "#grade3" ).val( $( "#grade-slider3" ).slider( "value" ) );
			  });
			  
			$(function() {
			    $( "#grade-slider4" ).slider({
			      range: "max",
			      min: 0,
			      max: 100,
			      value: 0,
			      slide: function( event, ui ) {
			        $( "#grade4" ).val( ui.value );
			      }
			    });
			    $( "#grade4" ).val( $( "#grade-slider4" ).slider( "value" ) );
			  });
			
			$("[rel=popover]").popover();

		});		
	</script>
</body>
</html>